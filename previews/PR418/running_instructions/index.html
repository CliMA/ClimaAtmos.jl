<!DOCTYPE html>
<html lang="en"><head><meta charset="UTF-8"/><meta name="viewport" content="width=device-width, initial-scale=1.0"/><title>Running instructions · ClimaAtmos.jl</title><script data-outdated-warner src="../assets/warner.js"></script><link href="https://cdnjs.cloudflare.com/ajax/libs/lato-font/3.0.0/css/lato-font.min.css" rel="stylesheet" type="text/css"/><link href="https://cdnjs.cloudflare.com/ajax/libs/juliamono/0.044/juliamono.css" rel="stylesheet" type="text/css"/><link href="https://cdnjs.cloudflare.com/ajax/libs/font-awesome/5.15.3/css/fontawesome.min.css" rel="stylesheet" type="text/css"/><link href="https://cdnjs.cloudflare.com/ajax/libs/font-awesome/5.15.3/css/solid.min.css" rel="stylesheet" type="text/css"/><link href="https://cdnjs.cloudflare.com/ajax/libs/font-awesome/5.15.3/css/brands.min.css" rel="stylesheet" type="text/css"/><link href="https://cdnjs.cloudflare.com/ajax/libs/KaTeX/0.13.11/katex.min.css" rel="stylesheet" type="text/css"/><script>documenterBaseURL=".."</script><script src="https://cdnjs.cloudflare.com/ajax/libs/require.js/2.3.6/require.min.js" data-main="../assets/documenter.js"></script><script src="../siteinfo.js"></script><script src="../../versions.js"></script><link class="docs-theme-link" rel="stylesheet" type="text/css" href="../assets/themes/documenter-dark.css" data-theme-name="documenter-dark" data-theme-primary-dark/><link class="docs-theme-link" rel="stylesheet" type="text/css" href="../assets/themes/documenter-light.css" data-theme-name="documenter-light" data-theme-primary/><script src="../assets/themeswap.js"></script></head><body><div id="documenter"><nav class="docs-sidebar"><div class="docs-package-name"><span class="docs-autofit"><a href="../">ClimaAtmos.jl</a></span></div><form class="docs-search" action="../search/"><input class="docs-search-query" id="documenter-search-query" name="q" type="text" placeholder="Search docs"/></form><ul class="docs-menu"><li><a class="tocitem" href="../">Home</a></li><li><a class="tocitem" href="../installation_instructions/">Installation instructions</a></li><li class="is-active"><a class="tocitem" href>Running instructions</a><ul class="internal"><li><a class="tocitem" href="#Running-Simulations"><span>Running Simulations</span></a></li></ul></li><li><a class="tocitem" href="../contributor_guide/">Contributor Guide</a></li><li><a class="tocitem" href="../function_index/">Function Index</a></li><li><a class="tocitem" href="../equations/">Equations</a></li></ul><div class="docs-version-selector field has-addons"><div class="control"><span class="docs-label button is-static is-size-7">Version</span></div><div class="docs-selector control is-expanded"><div class="select is-fullwidth is-size-7"><select id="documenter-version-selector"></select></div></div></div></nav><div class="docs-main"><header class="docs-navbar"><nav class="breadcrumb"><ul class="is-hidden-mobile"><li class="is-active"><a href>Running instructions</a></li></ul><ul class="is-hidden-tablet"><li class="is-active"><a href>Running instructions</a></li></ul></nav><div class="docs-right"><a class="docs-edit-link" href="https://github.com/CliMA/ClimaAtmos.jl/blob/master/docs/src/running_instructions.md" title="Edit on GitHub"><span class="docs-icon fab"></span><span class="docs-label is-hidden-touch">Edit on GitHub</span></a><a class="docs-settings-button fas fa-cog" id="documenter-settings-button" href="#" title="Settings"></a><a class="docs-sidebar-button fa fa-bars is-hidden-desktop" id="documenter-sidebar-button" href="#"></a></div></header><article class="content" id="documenter-page"><h1 id="Running-the-Test-Suite"><a class="docs-heading-anchor" href="#Running-the-Test-Suite">Running the Test Suite</a><a id="Running-the-Test-Suite-1"></a><a class="docs-heading-anchor-permalink" href="#Running-the-Test-Suite" title="Permalink"></a></h1><p>We store conventional benchmark simulation examples in the test folder, where they have access to standardized initial conditions. These benchmarks are used and reused in several tests ranging from unit, over regression, to complex validation tests. This guarantees that the same code piece can be efficiently reused.</p><p>Run all the test cases with:</p><pre><code class="nohighlight hljs">$ julia --project test/runtests.jl</code></pre><h2 id="Running-Simulations"><a class="docs-heading-anchor" href="#Running-Simulations">Running Simulations</a><a id="Running-Simulations-1"></a><a class="docs-heading-anchor-permalink" href="#Running-Simulations" title="Permalink"></a></h2><p>We create a <code>Simulation</code> object which contains information about the <code>model</code> configuration (including prognostic, auxiliary variables, initial conditions and parameters). In addition, we supply a time-stepping method (currently from a choice of solvers available within OrdinaryDiffEq.jl), and a list of callbacks (functions which are executed when pre-defined conditions are met, or at user specified time intervals). Simulation data may be stored via one such output callback, with the option to <code>restart</code> at an advanced timestep from available output files. Initial conditions are stored in the <code>Utils</code> directory. </p><p>Here we &quot;unwrap&quot; one of the conventional benchmarks (3D baroclinic wave) to present an example of a simulation assembled in the Julia REPL. Modules are loaded when necessary.  </p><ul><li>Set up parameters and get the initial conditions</li></ul><pre><code class="nohighlight hljs">julia&gt; using CLIMAParameters
julia&gt; using ClimaAtmos.Utils.InitialConditions: init_3d_baroclinic_wave
julia&gt; struct DryBaroclinicWaveParameters &lt;: CLIMAParameters.AbstractEarthParameterSet end
julia&gt; params = DryBaroclinicWaveParameters();
julia&gt; FT = Float64;</code></pre><ul><li>Set up the problem domain, assume we want 6 horizontal of polynomial order 3, and 10 vertical elements. ClimaAtmos is tested with <code>Float32</code>, <code>Float64</code>; if something doesn&#39;t work in <code>Float32</code> please raise an issue! </li></ul><pre><code class="nohighlight hljs">julia&gt; using ClimaAtmos.Domains 
julia&gt; domain = SphericalShell(FT, 
                               radius = CLIMAParameters.Planet.planet_radius(params), 
                               height = FT(30.0e3), 
                               nelements = (6,10),
                               npolynomial = 3)</code></pre><ul><li>For details on domain properties, see the <code>Domains</code> API documentation. To explore the properties of an existing <code>domain</code>, use </li></ul><p><code>show(domain)</code>. With the domain set up, we assemble our <code>model</code>, which contains information on discretization, boundary conditions, and problem specific parameters. </p><pre><code class="nohighlight hljs">julia&gt; using ClimaAtmos.Models.Nonhydrostatic3DModels
julia&gt; using ClimaAtmos.BoundaryConditions
julia&gt; model = Nonhydrostatic3DModel(
        domain = domain,
        boundary_conditions = nothing,
        parameters = params,
        hyperdiffusivity = FT(1e16),
    )
julia&gt; </code></pre><ul><li>For details on model properties, see the <code>Models</code> API documentation. To explore the properties of an existing <code>model</code>, use <code>show(model)</code>. We now select an integration method, SSPRK33 (available in the <code>OrdinaryDiffEq.jl</code> package) and construct the <code>simulation</code> object as follows:</li></ul><pre><code class="nohighlight hljs">julia&gt; using ClimaAtmos.Simulations
julia&gt; using UnPack
julia&gt; using OrdinaryDiffEq: SSPRK33
julia&gt; simulation = Simulation(model, SSPRK33(), dt = 0.02, tspan = (0.0, 1.0)) # Run for 1.0s in 0.02s intervals
julia&gt; @unpack ρ, uh, w, ρe_tot = init_3d_baroclinic_wave(FT, params); # Unpack from the standard initial condition function
julia&gt; set!(simulation, :base, ρ = ρ, uh = uh, w = w); # This depends on your model choice!
julia&gt; set!(simulation, :thermodynamics, ρe_tot = ρe_tot); # This depends on your model choice!  </code></pre><ul><li>For details on model properties, see the <code>Simulations</code> API documentation. Tracers, EDMF variables will have similar assignments using symbol identifiers. <code>simulation.integrator.u</code> now contains the initial state. e.g. <code>simulation.integrator.base.uh</code> contains horizontal velocities, and so on. <code>show(simulation)</code> to view information on an existing <code>simulation</code>. To begin time integration, we either <code>step!</code> or <code>run!</code> the simulation. </li></ul><pre><code class="nohighlight hljs">julia&gt; step!(simulation) # Advance simulation by one time-step
julia&gt; run!(simulation)  # Advance simulation to completion</code></pre><p><code>simulation.integrator.u</code> now contains the updated state. For <code>integrator</code> object properties, see the OrdinaryDiffEq documentation. </p></article><nav class="docs-footer"><a class="docs-footer-prevpage" href="../installation_instructions/">« Installation instructions</a><a class="docs-footer-nextpage" href="../contributor_guide/">Contributor Guide »</a><div class="flexbox-break"></div><p class="footer-message">Powered by <a href="https://github.com/JuliaDocs/Documenter.jl">Documenter.jl</a> and the <a href="https://julialang.org/">Julia Programming Language</a>.</p></nav></div><div class="modal" id="documenter-settings"><div class="modal-background"></div><div class="modal-card"><header class="modal-card-head"><p class="modal-card-title">Settings</p><button class="delete"></button></header><section class="modal-card-body"><p><label class="label">Theme</label><div class="select"><select id="documenter-themepicker"><option value="documenter-light">documenter-light</option><option value="documenter-dark">documenter-dark</option></select></div></p><hr/><p>This document was generated with <a href="https://github.com/JuliaDocs/Documenter.jl">Documenter.jl</a> version 0.27.16 on <span class="colophon-date" title="Saturday 7 May 2022 19:31">Saturday 7 May 2022</span>. Using Julia version 1.7.2.</p></section><footer class="modal-card-foot"></footer></div></div></div></body></html>
