<!DOCTYPE html>
<html lang="en"><head><meta charset="UTF-8"/><meta name="viewport" content="width=device-width, initial-scale=1.0"/><title>The time type · ClimaAtmos.jl</title><meta name="title" content="The time type · ClimaAtmos.jl"/><meta property="og:title" content="The time type · ClimaAtmos.jl"/><meta property="twitter:title" content="The time type · ClimaAtmos.jl"/><meta name="description" content="Documentation for ClimaAtmos.jl."/><meta property="og:description" content="Documentation for ClimaAtmos.jl."/><meta property="twitter:description" content="Documentation for ClimaAtmos.jl."/><script data-outdated-warner src="../assets/warner.js"></script><link href="https://cdnjs.cloudflare.com/ajax/libs/lato-font/3.0.0/css/lato-font.min.css" rel="stylesheet" type="text/css"/><link href="https://cdnjs.cloudflare.com/ajax/libs/juliamono/0.050/juliamono.min.css" rel="stylesheet" type="text/css"/><link href="https://cdnjs.cloudflare.com/ajax/libs/font-awesome/6.4.2/css/fontawesome.min.css" rel="stylesheet" type="text/css"/><link href="https://cdnjs.cloudflare.com/ajax/libs/font-awesome/6.4.2/css/solid.min.css" rel="stylesheet" type="text/css"/><link href="https://cdnjs.cloudflare.com/ajax/libs/font-awesome/6.4.2/css/brands.min.css" rel="stylesheet" type="text/css"/><link href="https://cdnjs.cloudflare.com/ajax/libs/KaTeX/0.16.8/katex.min.css" rel="stylesheet" type="text/css"/><script>documenterBaseURL=".."</script><script src="https://cdnjs.cloudflare.com/ajax/libs/require.js/2.3.6/require.min.js" data-main="../assets/documenter.js"></script><script src="../search_index.js"></script><script src="../siteinfo.js"></script><script src="../../versions.js"></script><link class="docs-theme-link" rel="stylesheet" type="text/css" href="../assets/themes/catppuccin-mocha.css" data-theme-name="catppuccin-mocha"/><link class="docs-theme-link" rel="stylesheet" type="text/css" href="../assets/themes/catppuccin-macchiato.css" data-theme-name="catppuccin-macchiato"/><link class="docs-theme-link" rel="stylesheet" type="text/css" href="../assets/themes/catppuccin-frappe.css" data-theme-name="catppuccin-frappe"/><link class="docs-theme-link" rel="stylesheet" type="text/css" href="../assets/themes/catppuccin-latte.css" data-theme-name="catppuccin-latte"/><link class="docs-theme-link" rel="stylesheet" type="text/css" href="../assets/themes/documenter-dark.css" data-theme-name="documenter-dark" data-theme-primary-dark/><link class="docs-theme-link" rel="stylesheet" type="text/css" href="../assets/themes/documenter-light.css" data-theme-name="documenter-light" data-theme-primary/><script src="../assets/themeswap.js"></script></head><body><div id="documenter"><nav class="docs-sidebar"><a class="docs-logo" href="../"><img src="../assets/logo.svg" alt="ClimaAtmos.jl logo"/></a><div class="docs-package-name"><span class="docs-autofit"><a href="../">ClimaAtmos.jl</a></span></div><button class="docs-search-query input is-rounded is-small is-clickable my-2 mx-auto py-1 px-2" id="documenter-search-query">Search docs (Ctrl + /)</button><ul class="docs-menu"><li><a class="tocitem" href="../">Home</a></li><li><a class="tocitem" href="../installation_instructions/">Installation instructions</a></li><li><a class="tocitem" href="../contributor_guide/">Contributor Guide</a></li><li><a class="tocitem" href="../equations/">Equations</a></li><li><a class="tocitem" href="../edmf_equations/">EDMF Equations</a></li><li><a class="tocitem" href="../diagnostics/">Diagnostics</a></li><li><a class="tocitem" href="../available_diagnostics/">Available Diagnostics</a></li><li><a class="tocitem" href="../diagnostic_edmf_equations/">Diagnostic EDMF Equations</a></li><li><a class="tocitem" href="../gravity_wave/">Gravity Wave Drag Parameterizations</a></li><li><a class="tocitem" href="../surface_albedo/">Ocean Surface Albedo Parameterization</a></li><li><a class="tocitem" href="../topography/">Topography Representation</a></li><li><a class="tocitem" href="../tracers/">Tracers</a></li><li><a class="tocitem" href="../radiative_equilibrium/">Radiative Equilibrium</a></li><li><a class="tocitem" href="../restarts/">Restarts and checkpoints</a></li><li><a class="tocitem" href="../repl_scripts/">REPL scripts</a></li><li><a class="tocitem" href="../config/">Configuration</a></li><li><a class="tocitem" href="../parameters/">Parameters</a></li><li><a class="tocitem" href="../longruns/">Longruns</a></li><li class="is-active"><a class="tocitem" href>The time type</a><ul class="internal"><li><a class="tocitem" href="#Why-not-use-floating-point-for-simulation-time?"><span>Why not use floating point for simulation time?</span></a></li><li><a class="tocitem" href="#Introduction-to-ITime"><span>Introduction to ITime</span></a></li><li><a class="tocitem" href="#How-do-I-use-ITime-in-my-simulation?"><span>How do I use ITime in my simulation?</span></a></li><li><a class="tocitem" href="#Developing-with-ITime"><span>Developing with ITime</span></a></li></ul></li><li><a class="tocitem" href="../api/">API</a></li><li><a class="tocitem" href="../references/">References</a></li></ul><div class="docs-version-selector field has-addons"><div class="control"><span class="docs-label button is-static is-size-7">Version</span></div><div class="docs-selector control is-expanded"><div class="select is-fullwidth is-size-7"><select id="documenter-version-selector"></select></div></div></div></nav><div class="docs-main"><header class="docs-navbar"><a class="docs-sidebar-button docs-navbar-link fa-solid fa-bars is-hidden-desktop" id="documenter-sidebar-button" href="#"></a><nav class="breadcrumb"><ul class="is-hidden-mobile"><li class="is-active"><a href>The time type</a></li></ul><ul class="is-hidden-tablet"><li class="is-active"><a href>The time type</a></li></ul></nav><div class="docs-right"><a class="docs-navbar-link" href="https://github.com/CliMA/ClimaAtmos.jl" title="View the repository on GitHub"><span class="docs-icon fa-brands"></span><span class="docs-label is-hidden-touch">GitHub</span></a><a class="docs-navbar-link" href="https://github.com/CliMA/ClimaAtmos.jl/blob/main/docs/src/itime.md" title="Edit source on GitHub"><span class="docs-icon fa-solid"></span></a><a class="docs-settings-button docs-navbar-link fa-solid fa-gear" id="documenter-settings-button" href="#" title="Settings"></a><a class="docs-article-toggle-button fa-solid fa-chevron-up" id="documenter-article-toggle-button" href="javascript:;" title="Collapse all docstrings"></a></div></header><article class="content" id="documenter-page"><h1 id="ITime"><a class="docs-heading-anchor" href="#ITime">ITime</a><a id="ITime-1"></a><a class="docs-heading-anchor-permalink" href="#ITime" title="Permalink"></a></h1><p><code>ITime</code>, or <em>integer time</em>, is a time type used by CliMA simulations to keep track of simulation time. For more information, refer to the <a href="https://clima.github.io/ClimaUtilities.jl/dev/timemanager/">TimeManager section</a>  in ClimaUtilities.</p><h2 id="Why-not-use-floating-point-for-simulation-time?"><a class="docs-heading-anchor" href="#Why-not-use-floating-point-for-simulation-time?">Why not use floating point for simulation time?</a><a id="Why-not-use-floating-point-for-simulation-time?-1"></a><a class="docs-heading-anchor-permalink" href="#Why-not-use-floating-point-for-simulation-time?" title="Permalink"></a></h2><p>Due to floating point errors, time can easily be inaccurate or stop incrementing (especially with Float32). For instance, consider the example below.</p><pre><code class="language-julia-repl hljs" style="display:block;">julia&gt; 0.1 + 0.1 + 0.1 == 0.3</code><code class="nohighlight hljs ansi" style="display:block;">false</code></pre><p>If <code>t = 0</code> and <code>dt = 0.1</code>, then the time of the simulation is already wrong when the simulation done just three time steps. This can easily accumulate into a larger error.</p><p>Additionally, time can stop incrementing as seen below.</p><pre><code class="language-julia-repl hljs" style="display:block;">julia&gt; Float32(16777216) + Float32(1) == Float32(16777216)</code><code class="nohighlight hljs ansi" style="display:block;">true</code></pre><p>In the expression above, if the number represents seconds, then time stops incrementing after about 194 days.</p><p>These issues propagate and lead to problems as we cannot reliably depend on the simulation time to be accurate. For instance, dates will always be wrong when converting from simulation time to date. Since dates are wrong, the diagnostics are saved after one timestep than they should be.</p><p>These are the issues that <code>ITime</code> aims to solve.</p><h2 id="Introduction-to-ITime"><a class="docs-heading-anchor" href="#Introduction-to-ITime">Introduction to ITime</a><a id="Introduction-to-ITime-1"></a><a class="docs-heading-anchor-permalink" href="#Introduction-to-ITime" title="Permalink"></a></h2><p><code>ITime</code> consists of three fields: <code>counter</code>, <code>period</code>, and <code>epoch</code>. The counter keeps track of the number of <code>period</code>s since the <code>epoch</code> if it exists. See the examples below of constructing an <code>ITime</code>.</p><pre><code class="language-julia-repl hljs" style="display:block;">julia&gt; using ClimaUtilities.TimeManager, Dates # ITime is from ClimaUtilities</code><code class="nohighlight hljs ansi" style="display:block;"></code><br/><code class="language-julia-repl hljs" style="display:block;">julia&gt; x = ITime(3, period = Minute(1), epoch = DateTime(2010))</code><code class="nohighlight hljs ansi" style="display:block;">3 minutes (2010-01-01T00:03:00) [counter = 3, period = 1 minute, epoch = 2010-01-01T00:00:00]</code><br/><code class="language-julia-repl hljs" style="display:block;">julia&gt; counter(x)</code><code class="nohighlight hljs ansi" style="display:block;">3</code><br/><code class="language-julia-repl hljs" style="display:block;">julia&gt; period(x)</code><code class="nohighlight hljs ansi" style="display:block;">1 minute</code><br/><code class="language-julia-repl hljs" style="display:block;">julia&gt; epoch(x)</code><code class="nohighlight hljs ansi" style="display:block;">2010-01-01T00:00:00</code></pre><p><code>ITime</code>s can be thought of as a number with units. Hence, addition and subtraction is what we expected, but multiplication between <code>ITime</code>s is not defined and division results in a number rather than an <code>ITime</code>. For more information about what functions are available for <code>ITime</code>, see the <a href="https://clima.github.io/ClimaUtilities.jl/dev/timemanager/#TimeManager-API">API</a> at ClimaUtilities.</p><pre><code class="language-julia-repl hljs" style="display:block;">julia&gt; y = ITime(60, period = Second(1), epoch = DateTime(2010))</code><code class="nohighlight hljs ansi" style="display:block;">60 seconds (2010-01-01T00:01:00) [counter = 60, period = 1 second, epoch = 2010-01-01T00:00:00]</code><br/><code class="language-julia-repl hljs" style="display:block;">julia&gt; x + y</code><code class="nohighlight hljs ansi" style="display:block;">240 seconds (2010-01-01T00:04:00) [counter = 240, period = 1 second, epoch = 2010-01-01T00:00:00]</code><br/><code class="language-julia-repl hljs" style="display:block;">julia&gt; x - y</code><code class="nohighlight hljs ansi" style="display:block;">120 seconds (2010-01-01T00:02:00) [counter = 120, period = 1 second, epoch = 2010-01-01T00:00:00]</code><br/><code class="language-julia-repl hljs" style="display:block;">julia&gt; x / y</code><code class="nohighlight hljs ansi" style="display:block;">3//1</code></pre><h2 id="How-do-I-use-ITime-in-my-simulation?"><a class="docs-heading-anchor" href="#How-do-I-use-ITime-in-my-simulation?">How do I use ITime in my simulation?</a><a id="How-do-I-use-ITime-in-my-simulation?-1"></a><a class="docs-heading-anchor-permalink" href="#How-do-I-use-ITime-in-my-simulation?" title="Permalink"></a></h2><p>In this section, we address how to use <code>ITime</code> instead of floating point for time in a ClimaAtmos simulation and how to write code with <code>ITime</code> in mind.</p><p>If you are running a simulation from a YAML file, you can simply set <code>use_itime</code> to <code>true</code> to enable <code>ITime</code>. If you do not want to use <code>ITime</code>, then set <code>use_itime</code> to <code>false</code> to not use <code>ITime</code> which will use floating point instead.</p><div class="admonition is-info"><header class="admonition-header">Different results from rounding using `ITime`</header><div class="admonition-body"><p>If <code>a</code> is a floating point number and <code>t</code> is an <code>ITime</code>, then we round <code>a * t</code> to the nearest integer for the <code>counter</code>, while keeping the same <code>period</code> and <code>epoch</code> if it exists. As a result, the simulation will run at a resolution of the period used for <code>ITime</code>. This could leads to slight differences in the surface conditions and the time dependent forcing and tendencies that explicitly depend on time.</p></div></div><div class="admonition is-info"><header class="admonition-header">Different results from `float` on `ITime`</header><div class="admonition-body"><p>Using <code>float</code> on an <code>ITime</code> returns a <code>Float64</code>. As such, a simulation running Float32 and a simulation running <code>ITime</code> for time and <code>Float32</code> for everything else will return different results.</p></div></div><h2 id="Developing-with-ITime"><a class="docs-heading-anchor" href="#Developing-with-ITime">Developing with ITime</a><a id="Developing-with-ITime-1"></a><a class="docs-heading-anchor-permalink" href="#Developing-with-ITime" title="Permalink"></a></h2><p>Some helpful functions when working with <code>ITime</code>s are <code>float</code>, <code>date</code>, and <code>promote</code>.</p><p>When working with <code>ITime</code>, you might need <code>t</code>, an <code>ITime</code>, to be the number of seconds. This can be done by using the function <code>float</code> on <code>t</code>. For other cases, you might need the current date which you can get by using the function <code>date</code> on <code>t</code>. Finally, when working with <code>ITime</code>s, the types of the <code>ITime</code>s might not match (e.g. the periods are different). To handle this, you can use <code>promote</code> on the two <code>ITime</code>s. For more information about developing with <code>ITime</code>, see the <code>ITime</code> <a href="https://clima.github.io/ClimaUtilities.jl/dev/timemanager/">documentation</a>  in ClimaUtilities.</p><pre><code class="language-julia-repl hljs" style="display:block;">julia&gt; float(x)</code><code class="nohighlight hljs ansi" style="display:block;">180.0</code><br/><code class="language-julia-repl hljs" style="display:block;">julia&gt; date(x)</code><code class="nohighlight hljs ansi" style="display:block;">2010-01-01T00:03:00</code><br/><code class="language-julia-repl hljs" style="display:block;">julia&gt; promote(x, y)</code><code class="nohighlight hljs ansi" style="display:block;">(180 seconds (2010-01-01T00:03:00) [counter = 180, period = 1 second, epoch = 2010-01-01T00:00:00], 60 seconds (2010-01-01T00:01:00) [counter = 60, period = 1 second, epoch = 2010-01-01T00:00:00])</code></pre></article><nav class="docs-footer"><a class="docs-footer-prevpage" href="../longruns/">« Longruns</a><a class="docs-footer-nextpage" href="../api/">API »</a><div class="flexbox-break"></div><p class="footer-message">Powered by <a href="https://github.com/JuliaDocs/Documenter.jl">Documenter.jl</a> and the <a href="https://julialang.org/">Julia Programming Language</a>.</p></nav></div><div class="modal" id="documenter-settings"><div class="modal-background"></div><div class="modal-card"><header class="modal-card-head"><p class="modal-card-title">Settings</p><button class="delete"></button></header><section class="modal-card-body"><p><label class="label">Theme</label><div class="select"><select id="documenter-themepicker"><option value="auto">Automatic (OS)</option><option value="documenter-light">documenter-light</option><option value="documenter-dark">documenter-dark</option><option value="catppuccin-latte">catppuccin-latte</option><option value="catppuccin-frappe">catppuccin-frappe</option><option value="catppuccin-macchiato">catppuccin-macchiato</option><option value="catppuccin-mocha">catppuccin-mocha</option></select></div></p><hr/><p>This document was generated with <a href="https://github.com/JuliaDocs/Documenter.jl">Documenter.jl</a> version 1.8.1 on <span class="colophon-date" title="Wednesday 12 February 2025 16:17">Wednesday 12 February 2025</span>. Using Julia version 1.11.3.</p></section><footer class="modal-card-foot"></footer></div></div></div></body></html>
