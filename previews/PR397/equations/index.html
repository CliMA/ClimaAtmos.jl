<!DOCTYPE html>
<html lang="en"><head><meta charset="UTF-8"/><meta name="viewport" content="width=device-width, initial-scale=1.0"/><title>Equations · ClimaAtmos.jl</title><script data-outdated-warner src="../assets/warner.js"></script><link href="https://cdnjs.cloudflare.com/ajax/libs/lato-font/3.0.0/css/lato-font.min.css" rel="stylesheet" type="text/css"/><link href="https://cdnjs.cloudflare.com/ajax/libs/juliamono/0.044/juliamono.css" rel="stylesheet" type="text/css"/><link href="https://cdnjs.cloudflare.com/ajax/libs/font-awesome/5.15.3/css/fontawesome.min.css" rel="stylesheet" type="text/css"/><link href="https://cdnjs.cloudflare.com/ajax/libs/font-awesome/5.15.3/css/solid.min.css" rel="stylesheet" type="text/css"/><link href="https://cdnjs.cloudflare.com/ajax/libs/font-awesome/5.15.3/css/brands.min.css" rel="stylesheet" type="text/css"/><link href="https://cdnjs.cloudflare.com/ajax/libs/KaTeX/0.13.11/katex.min.css" rel="stylesheet" type="text/css"/><script>documenterBaseURL=".."</script><script src="https://cdnjs.cloudflare.com/ajax/libs/require.js/2.3.6/require.min.js" data-main="../assets/documenter.js"></script><script src="../siteinfo.js"></script><script src="../../versions.js"></script><link class="docs-theme-link" rel="stylesheet" type="text/css" href="../assets/themes/documenter-dark.css" data-theme-name="documenter-dark" data-theme-primary-dark/><link class="docs-theme-link" rel="stylesheet" type="text/css" href="../assets/themes/documenter-light.css" data-theme-name="documenter-light" data-theme-primary/><script src="../assets/themeswap.js"></script></head><body><div id="documenter"><nav class="docs-sidebar"><div class="docs-package-name"><span class="docs-autofit"><a href="../">ClimaAtmos.jl</a></span></div><form class="docs-search" action="../search/"><input class="docs-search-query" id="documenter-search-query" name="q" type="text" placeholder="Search docs"/></form><ul class="docs-menu"><li><a class="tocitem" href="../">Home</a></li><li><a class="tocitem" href="../installation_instructions/">Installation instructions</a></li><li><a class="tocitem" href="../running_instructions/">Running instructions</a></li><li><a class="tocitem" href="../contributor_guide/">Contributor Guide</a></li><li><a class="tocitem" href="../function_index/">Function Index</a></li><li class="is-active"><a class="tocitem" href>Equations</a><ul class="internal"><li><a class="tocitem" href="#Prognostic-variables"><span>Prognostic variables</span></a></li><li><a class="tocitem" href="#Operators"><span>Operators</span></a></li><li><a class="tocitem" href="#Auxiliary-and-derived-quantities"><span>Auxiliary and derived quantities</span></a></li><li><a class="tocitem" href="#Equations-and-discretizations"><span>Equations and discretizations</span></a></li></ul></li></ul><div class="docs-version-selector field has-addons"><div class="control"><span class="docs-label button is-static is-size-7">Version</span></div><div class="docs-selector control is-expanded"><div class="select is-fullwidth is-size-7"><select id="documenter-version-selector"></select></div></div></div></nav><div class="docs-main"><header class="docs-navbar"><nav class="breadcrumb"><ul class="is-hidden-mobile"><li class="is-active"><a href>Equations</a></li></ul><ul class="is-hidden-tablet"><li class="is-active"><a href>Equations</a></li></ul></nav><div class="docs-right"><a class="docs-edit-link" href="https://github.com/CliMA/ClimaAtmos.jl/blob/master/docs/src/equations.md" title="Edit on GitHub"><span class="docs-icon fab"></span><span class="docs-label is-hidden-touch">Edit on GitHub</span></a><a class="docs-settings-button fas fa-cog" id="documenter-settings-button" href="#" title="Settings"></a><a class="docs-sidebar-button fa fa-bars is-hidden-desktop" id="documenter-sidebar-button" href="#"></a></div></header><article class="content" id="documenter-page"><h1 id="Equations"><a class="docs-heading-anchor" href="#Equations">Equations</a><a id="Equations-1"></a><a class="docs-heading-anchor-permalink" href="#Equations" title="Permalink"></a></h1><div class="admonition is-info"><header class="admonition-header">Note</header><div class="admonition-body"><p>This follows what is <em>currently</em> implemented in <code>examples</code>: it should be kept up-to-date as code is modified. If you think something <em>should</em> be changed (but hasn&#39;t been), please add a note.</p></div></div><p>This describes the ClimaAtmos model equations and its discretizations. Where possible, we use a coordinate invariant form: the ClimaCore operators generally handle the conversions between bases internally.</p><h2 id="Prognostic-variables"><a class="docs-heading-anchor" href="#Prognostic-variables">Prognostic variables</a><a id="Prognostic-variables-1"></a><a class="docs-heading-anchor-permalink" href="#Prognostic-variables" title="Permalink"></a></h2><ul><li><span>$\rho$</span>: <em>density</em> in kg/m³. This is discretized at cell centers.</li><li><span>$\boldsymbol{u}$</span> <em>velocity</em>, a vector in m/s. This is discretized via <span>$\boldsymbol{u} = \boldsymbol{u}_h + \boldsymbol{u}_v$</span> where<ul><li><span>$\boldsymbol{u}_h = u_1 \boldsymbol{e}^1 + u_2 \boldsymbol{e}^2$</span> is the projection onto horizontal covariant components (covariance here means with respect to the reference element), stored at cell centers.</li><li><span>$\boldsymbol{u}_v = u_3 \boldsymbol{e}^3$</span> is the projection onto the vertical covariant components, stored at cell faces.</li></ul></li><li><em>energy</em>, stored at cell centers; can be either:<ul><li><span>$\rho e$</span>: <em>total energy</em> in J/m³</li><li><span>$\rho e_\text{int}$</span>: <em>internal energy</em> in J/m³</li></ul></li><li><span>$\rho \chi$</span>: <em>other conserved scalars</em> (moisture, tracers, etc), again stored at cell centers.</li></ul><h2 id="Operators"><a class="docs-heading-anchor" href="#Operators">Operators</a><a id="Operators-1"></a><a class="docs-heading-anchor-permalink" href="#Operators" title="Permalink"></a></h2><p>We make use of the following operators</p><h3 id="Reconstruction"><a class="docs-heading-anchor" href="#Reconstruction">Reconstruction</a><a id="Reconstruction-1"></a><a class="docs-heading-anchor-permalink" href="#Reconstruction" title="Permalink"></a></h3><ul><li><span>$I^c$</span> is the <a href="https://clima.github.io/ClimaCore.jl/stable/operators/#ClimaCore.Operators.InterpolateF2C">face-to-center reconstruction operator</a></li><li><span>$I^f$</span> is the <a href="https://clima.github.io/ClimaCore.jl/stable/operators/#ClimaCore.Operators.InterpolateC2F">center-to-face reconstruction operator</a><ul><li>Currently this is just the arithmetic mean, but we will need to use a weighted version with stretched vertical grids.</li></ul></li><li><span>$U^f$</span> is the <a href="https://clima.github.io/ClimaCore.jl/stable/operators/#ClimaCore.Operators.UpwindBiasedProductC2F">center-to-face upwind product operator</a><ul><li>Currently this is first-order, we will switch this to third-order.</li></ul></li></ul><h3 id="Differentiation-operators"><a class="docs-heading-anchor" href="#Differentiation-operators">Differentiation operators</a><a id="Differentiation-operators-1"></a><a class="docs-heading-anchor-permalink" href="#Differentiation-operators" title="Permalink"></a></h3><ul><li><span>$D_h$</span> is the <a href="https://clima.github.io/ClimaCore.jl/stable/operators/#ClimaCore.Operators.Divergence">discrete horizontal spectral divergence</a>.</li><li><span>$D^c_v$</span> is the <a href="https://clima.github.io/ClimaCore.jl/stable/operators/#ClimaCore.Operators.DivergenceF2C">face-to-center vertical divergence</a>.<ul><li>Currently fluxes are set to zero at the top and bottom boundaries: this will need to be modified with the addition of diffusive fluxes.</li></ul></li><li><span>$G_h$</span> is the <a href="https://clima.github.io/ClimaCore.jl/stable/operators/#ClimaCore.Operators.Gradient">discrete horizontal spectral gradient</a>.</li><li><span>$G^f_v$</span> is the <a href="https://clima.github.io/ClimaCore.jl/stable/operators/#ClimaCore.Operators.GradientC2F">center-to-face vertical gradient</a>.<ul><li>the gradient is set to 0 at the top and bottom boundaries.</li></ul></li><li><span>$C_h$</span> is the <a href="https://clima.github.io/ClimaCore.jl/stable/operators/#ClimaCore.Operators.Curl">horizontal curl</a><ul><li><span>$C_h[\boldsymbol{u}_h]$</span> returns a vector with only vertical <em>contravariant</em> components.</li><li><span>$C_h[\boldsymbol{u}_v]$</span> returns a vector with only horizontal <em>contravariant</em> components.</li></ul></li><li><span>$C^f_v$</span> is the <a href="https://clima.github.io/ClimaCore.jl/stable/operators/#ClimaCore.Operators.CurlC2F">center-to-face vertical curl</a>.<ul><li><span>$C^f_v[\boldsymbol{u}_h]$</span> returns a vector with only a horizontal <em>contravariant</em> component.</li><li>the curl is set to 0 at the top and bottom boundaries.<ul><li>We need to clarify how best to handle this.</li></ul></li></ul></li></ul><h2 id="Auxiliary-and-derived-quantities"><a class="docs-heading-anchor" href="#Auxiliary-and-derived-quantities">Auxiliary and derived quantities</a><a id="Auxiliary-and-derived-quantities-1"></a><a class="docs-heading-anchor-permalink" href="#Auxiliary-and-derived-quantities" title="Permalink"></a></h2><ul><li><span>$\boldsymbol{\Omega}$</span> is the planetary angular velocity. We currently use a shallow-atmosphere approximation, with<p class="math-container">\[\boldsymbol{\Omega} = \Omega \sin(\phi) \boldsymbol{e}^v\]</p>where <span>$\phi$</span> is latitude, and <span>$\Omega$</span> is the planetary rotation rate in rads/sec (for Earth, <span>$7.29212 \times 10^{-5}$</span>) and <span>$\boldsymbol{e}^v$</span> is the unit radial basis vector. This implies that the horizontal contravariant component <span>$\boldsymbol{\Omega}^h$</span> is zero.</li><li><span>$\Phi = g z$</span> is the geopotential, where <span>$g$</span> is the gravitational acceleration rate and <span>$z$</span> is altitude above the mean sea level.</li><li><span>$K = \tfrac{1}{2} \|\boldsymbol{u}\|^2$</span> is the specific kinetic energy (J/kg), reconstructed at cell centers by<p class="math-container">\[K = \tfrac{1}{2} \|\boldsymbol{u}_h + I^c(\boldsymbol{u}_v)\|^2.\]</p>where <span>$\|\boldsymbol{u}\|^2 = g^{ij} \boldsymbol{u}_i \boldsymbol{u}_j$</span> and <span>$g^{ij}$</span> is the contravariant metric tensor.</li><li><span>$p$</span> is air pressure, derived from the thermodynamic state, reconstructed at cell centers.</li></ul><h2 id="Equations-and-discretizations"><a class="docs-heading-anchor" href="#Equations-and-discretizations">Equations and discretizations</a><a id="Equations-and-discretizations-1"></a><a class="docs-heading-anchor-permalink" href="#Equations-and-discretizations" title="Permalink"></a></h2><h3 id="Mass"><a class="docs-heading-anchor" href="#Mass">Mass</a><a id="Mass-1"></a><a class="docs-heading-anchor-permalink" href="#Mass" title="Permalink"></a></h3><p>Follows the continuity equation</p><p class="math-container">\[\frac{\partial}{\partial t} \rho = - \nabla \cdot(\rho \boldsymbol{u}) .\]</p><p>This is discretized using the following</p><p class="math-container">\[\frac{\partial}{\partial t} \rho \approx - D_h[ \rho (\boldsymbol{u}_h + I^c(\boldsymbol{u}_v))] - D^c_v[I^f(\rho \boldsymbol{u}_h)) + I^f(\rho) \boldsymbol{u}_v)]\]</p><p>with the</p><p class="math-container">\[-D^c_v[I^f(\rho) \boldsymbol{u}_v)]\]</p><p>term treated implicitly.</p><h3 id="Momentum"><a class="docs-heading-anchor" href="#Momentum">Momentum</a><a id="Momentum-1"></a><a class="docs-heading-anchor-permalink" href="#Momentum" title="Permalink"></a></h3><p>Uses the advective form equation</p><p class="math-container">\[\frac{\partial}{\partial t} \boldsymbol{u}  = - (2 \boldsymbol{\Omega} + \nabla \times \boldsymbol{u}) \times \boldsymbol{u} - \frac{1}{\rho} \nabla p  - \nabla(\Phi + K) .\]</p><h4 id="Horizontal-momentum"><a class="docs-heading-anchor" href="#Horizontal-momentum">Horizontal momentum</a><a id="Horizontal-momentum-1"></a><a class="docs-heading-anchor-permalink" href="#Horizontal-momentum" title="Permalink"></a></h4><p>By breaking the curl and cross product terms into horizontal and vertical contributions, and removing zero terms (e.g. <span>$\nabla_v  \times \boldsymbol{u}_v = 0$</span>), we obtain</p><p class="math-container">\[\frac{\partial}{\partial t} \boldsymbol{u}_h  =
  - (\nabla_v \times \boldsymbol{u}_h +  \nabla_h \times \boldsymbol{u}_v) \times \boldsymbol{u}^v
  - (2 \boldsymbol{\Omega}^v + \nabla_h \times \boldsymbol{u}_h) \times \boldsymbol{u}^h
  - \frac{1}{\rho} \nabla_h p  - \nabla_h (\Phi + K) ,\]</p><p>where <span>$\boldsymbol{u}^h$</span> and <span>$\boldsymbol{u}^v$</span> are the horizontal and vertical <em>contravariant</em> vectors.</p><div class="admonition is-category-todo"><header class="admonition-header">Todo</header><div class="admonition-body"><p>Without topography, these are equal to their covariant vectors (i.e. <span>$\boldsymbol{u}^h = \boldsymbol{u}_h$</span>), but these will need to be updated with the addition of topography.</p></div></div><p>The <span>$(\nabla_v \times \boldsymbol{u}_h +  \nabla_h \times \boldsymbol{u}_v) \times \boldsymbol{u}^v$</span> term is discretized as</p><p class="math-container">\[I^c((C^f_v[\boldsymbol{u}_h] + C_h[\boldsymbol{u}_v]) \times \boldsymbol{u}^v)\]</p><p>The <span>$(2 \boldsymbol{\Omega}^v + \nabla_h \times \boldsymbol{u}_h) \times \boldsymbol{u}^h$</span> term is discretized as</p><p class="math-container">\[(2 \boldsymbol{\Omega}^v + C_h[\boldsymbol{u}_h]) \times \boldsymbol{u}^h\]</p><p>and the <span>$\frac{1}{\rho} \nabla_h p  + \nabla_h (\Phi + K)$</span> as</p><p class="math-container">\[\frac{1}{\rho} G_h[p] + G_h[\Phi + K] ,\]</p><p>where all these terms are treated explicitly.</p><h4 id="Vertical-momentum"><a class="docs-heading-anchor" href="#Vertical-momentum">Vertical momentum</a><a id="Vertical-momentum-1"></a><a class="docs-heading-anchor-permalink" href="#Vertical-momentum" title="Permalink"></a></h4><p>Similarly for vertical velocity</p><p class="math-container">\[\frac{\partial}{\partial t} \boldsymbol{u}_v  =
  - (\nabla_v \times \boldsymbol{u}_h + \nabla_h \times \boldsymbol{u}_v) \times \boldsymbol{u}^h
  - \frac{1}{\rho} \nabla_v p - \nabla_v(\Phi + K) .\]</p><p>The <span>$(\nabla_v \times \boldsymbol{u}_h + \nabla_h \times \boldsymbol{u}_v) \times \boldsymbol{u}^h$</span> term is discretized as</p><p class="math-container">\[(C^f_v[\boldsymbol{u}_h] + C_h[\boldsymbol{u}_v]) \times I^f(\boldsymbol{u}_h) ,\]</p><p>and the <span>$\frac{1}{\rho} \nabla_v p + \nabla_v(\Phi + K)$</span> term as</p><p class="math-container">\[\frac{1}{I^f(\rho)} G^f_v[p] + G^f[K + \Phi] ,\]</p><p>with the latter treated implicitly.</p><h3 id="Total-energy"><a class="docs-heading-anchor" href="#Total-energy">Total energy</a><a id="Total-energy-1"></a><a class="docs-heading-anchor-permalink" href="#Total-energy" title="Permalink"></a></h3><p class="math-container">\[\frac{\partial}{\partial t} \rho e = - \nabla \cdot((\rho e + p) \boldsymbol{u})\]</p><p>is discretized using</p><p class="math-container">\[\frac{\partial}{\partial t} \rho e \approx
- D_h[ (\rho e + p) (\boldsymbol{u}_h + I^c(\boldsymbol{u}_v))]
- D^c_v \left[
  I^f(\rho) U^f\left(\boldsymbol{u}_v, \frac{\rho e + p}{\rho} \right)
  + (\rho e + p) I^f(\boldsymbol{u}_h)
  \right] .\]</p><p>Currently the central reconstruction</p><p class="math-container">\[- D^c_v[ I^f(\rho e + p) \boldsymbol{u}_v ]\]</p><p>is treated implicitly.</p><div class="admonition is-category-todo"><header class="admonition-header">Todo</header><div class="admonition-body"><p>The Jacobian computation should be updated so that the upwinded term</p><p class="math-container">\[- D^c_v\left[I^f(\rho) U^f\left(\boldsymbol{u}_v, \frac{\rho e + p}{\rho} \right)\right]\]</p><p>is treated implicitly.</p></div></div><h3 id="Internal-energy"><a class="docs-heading-anchor" href="#Internal-energy">Internal energy</a><a id="Internal-energy-1"></a><a class="docs-heading-anchor-permalink" href="#Internal-energy" title="Permalink"></a></h3><p class="math-container">\[\frac{\partial}{\partial t} \rho e_\text{int} = - \nabla \cdot((\rho e_\text{int} + p) \boldsymbol{u}) + (\nabla p) \cdot \boldsymbol{u} .\]</p><p>The <span>$\nabla \cdot((\rho e_\text{int} + p) \boldsymbol{u}$</span> term is discretized the same as in total energy:</p><p class="math-container">\[D_h[ (\rho e_\text{int} + p) (\boldsymbol{u}_h + I^c(\boldsymbol{u}_v))] +
D^c_v\left[
  I^f(\rho) U^f\left(I^f(\boldsymbol{u}_v, \frac{\rho e_\text{int} + p}{\rho} \right)
  + (\rho e_\text{int} + p)  I^f(\boldsymbol{u}_h)
\right] .\]</p><p>The <span>$(\nabla p) \cdot \boldsymbol{u}$</span> term is discretized as</p><p class="math-container">\[I^c( G^f_v(p) \cdot \boldsymbol{u}_v) + G_h(p) \cdot \boldsymbol{u}_h .\]</p><div class="admonition is-category-todo"><header class="admonition-header">Todo</header><div class="admonition-body"><p>We will need to add <span>$\nabla_h \cdot u_v$</span> and <span>$\nabla_v \cdot u_h$</span> terms, as they will be non-zero in the presence of topography.</p></div></div><p>Currently the central reconstruction</p><p class="math-container">\[- D^c_v[ I^f(\rho e_\text{int} + p) \boldsymbol{u}_v ] + I^c( G^f_v(p) \cdot \boldsymbol{u}_v)\]</p><p>is treated implicitly.</p><div class="admonition is-category-todo"><header class="admonition-header">Todo</header><div class="admonition-body"><p>This should be updated so that the upwinded term</p><p class="math-container">\[- D^c_v\left[I^f(\rho) U^f\left(\boldsymbol{u}_v, \frac{\rho e_\text{int} + p}{\rho} \right)\right]\]</p><p>is treated implicitly.</p></div></div><h3 id="Scalars"><a class="docs-heading-anchor" href="#Scalars">Scalars</a><a id="Scalars-1"></a><a class="docs-heading-anchor-permalink" href="#Scalars" title="Permalink"></a></h3><p>For an arbitrary scalar <span>$\chi$</span>, the density-weighted scalar <span>$\rho\chi$</span> follows the continuity equation</p><p class="math-container">\[\frac{\partial}{\partial t} \rho \chi = - \nabla \cdot(\rho \chi \boldsymbol{u}) .\]</p><p>This is discretized using the following</p><p class="math-container">\[\frac{\partial}{\partial t} \rho \chi \approx
- D_h[ \rho \chi (\boldsymbol{u}_h + I^c(\boldsymbol{u}_v))]
- D^c_v\left[I^f(\rho) U^f\left(I^f(\boldsymbol{u}_h) + \boldsymbol{u}_v, \frac{\rho \chi}{\rho} \right) \right] .\]</p><p>Currently the central reconstruction</p><p class="math-container">\[- D^c_v[ I^f(\rho \chi) \boldsymbol{u}_v ]\]</p><p>is treated implicitly.</p><div class="admonition is-category-todo"><header class="admonition-header">Todo</header><div class="admonition-body"><p>The Jacobian computation should be updated so that the upwinded term</p><p class="math-container">\[- D^c_v\left[I^f(\rho) U^f\left(I^f(\boldsymbol{u}_h) + \boldsymbol{u}_v, \frac{\rho \chi}{\rho} \right) \right]\]</p><p>is treated implicitly.</p></div></div></article><nav class="docs-footer"><a class="docs-footer-prevpage" href="../function_index/">« Function Index</a><div class="flexbox-break"></div><p class="footer-message">Powered by <a href="https://github.com/JuliaDocs/Documenter.jl">Documenter.jl</a> and the <a href="https://julialang.org/">Julia Programming Language</a>.</p></nav></div><div class="modal" id="documenter-settings"><div class="modal-background"></div><div class="modal-card"><header class="modal-card-head"><p class="modal-card-title">Settings</p><button class="delete"></button></header><section class="modal-card-body"><p><label class="label">Theme</label><div class="select"><select id="documenter-themepicker"><option value="documenter-light">documenter-light</option><option value="documenter-dark">documenter-dark</option></select></div></p><hr/><p>This document was generated with <a href="https://github.com/JuliaDocs/Documenter.jl">Documenter.jl</a> version 0.27.16 on <span class="colophon-date" title="Wednesday 4 May 2022 18:52">Wednesday 4 May 2022</span>. Using Julia version 1.7.2.</p></section><footer class="modal-card-foot"></footer></div></div></div></body></html>
