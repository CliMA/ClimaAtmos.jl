<!DOCTYPE html>
<html lang="en"><head><meta charset="UTF-8"/><meta name="viewport" content="width=device-width, initial-scale=1.0"/><title>Gravity Wave Drag Parameterizations · ClimaAtmos.jl</title><meta name="title" content="Gravity Wave Drag Parameterizations · ClimaAtmos.jl"/><meta property="og:title" content="Gravity Wave Drag Parameterizations · ClimaAtmos.jl"/><meta property="twitter:title" content="Gravity Wave Drag Parameterizations · ClimaAtmos.jl"/><meta name="description" content="Documentation for ClimaAtmos.jl."/><meta property="og:description" content="Documentation for ClimaAtmos.jl."/><meta property="twitter:description" content="Documentation for ClimaAtmos.jl."/><script data-outdated-warner src="../assets/warner.js"></script><link href="https://cdnjs.cloudflare.com/ajax/libs/lato-font/3.0.0/css/lato-font.min.css" rel="stylesheet" type="text/css"/><link href="https://cdnjs.cloudflare.com/ajax/libs/juliamono/0.050/juliamono.min.css" rel="stylesheet" type="text/css"/><link href="https://cdnjs.cloudflare.com/ajax/libs/font-awesome/6.4.2/css/fontawesome.min.css" rel="stylesheet" type="text/css"/><link href="https://cdnjs.cloudflare.com/ajax/libs/font-awesome/6.4.2/css/solid.min.css" rel="stylesheet" type="text/css"/><link href="https://cdnjs.cloudflare.com/ajax/libs/font-awesome/6.4.2/css/brands.min.css" rel="stylesheet" type="text/css"/><link href="https://cdnjs.cloudflare.com/ajax/libs/KaTeX/0.16.8/katex.min.css" rel="stylesheet" type="text/css"/><script>documenterBaseURL=".."</script><script src="https://cdnjs.cloudflare.com/ajax/libs/require.js/2.3.6/require.min.js" data-main="../assets/documenter.js"></script><script src="../search_index.js"></script><script src="../siteinfo.js"></script><script src="../../versions.js"></script><link class="docs-theme-link" rel="stylesheet" type="text/css" href="../assets/themes/documenter-dark.css" data-theme-name="documenter-dark" data-theme-primary-dark/><link class="docs-theme-link" rel="stylesheet" type="text/css" href="../assets/themes/documenter-light.css" data-theme-name="documenter-light" data-theme-primary/><script src="../assets/themeswap.js"></script></head><body><div id="documenter"><nav class="docs-sidebar"><a class="docs-logo" href="../"><img src="../assets/logo.svg" alt="ClimaAtmos.jl logo"/></a><div class="docs-package-name"><span class="docs-autofit"><a href="../">ClimaAtmos.jl</a></span></div><button class="docs-search-query input is-rounded is-small is-clickable my-2 mx-auto py-1 px-2" id="documenter-search-query">Search docs (Ctrl + /)</button><ul class="docs-menu"><li><a class="tocitem" href="../">Home</a></li><li><a class="tocitem" href="../installation_instructions/">Installation instructions</a></li><li><a class="tocitem" href="../contributor_guide/">Contributor Guide</a></li><li><a class="tocitem" href="../equations/">Equations</a></li><li><a class="tocitem" href="../edmf_equations/">EDMF Equations</a></li><li><a class="tocitem" href="../diagnostics/">Diagnostics</a></li><li><a class="tocitem" href="../available_diagnostics/">Available Diagnostics</a></li><li><a class="tocitem" href="../diagnostic_edmf_equations/">Diagnostic EDMF Equations</a></li><li class="is-active"><a class="tocitem" href>Gravity Wave Drag Parameterizations</a><ul class="internal"><li><a class="tocitem" href="#Non-orographic-gravity-wave"><span>Non-orographic gravity wave</span></a></li><li><a class="tocitem" href="#Orographic-gravity-wave"><span>Orographic gravity wave</span></a></li></ul></li><li><a class="tocitem" href="../surface_albedo/">Ocean Surface Albedo Parameterization</a></li><li><a class="tocitem" href="../radiative_equilibrium/">Radiative Equilibrium</a></li><li><a class="tocitem" href="../repl_scripts/">REPL scripts</a></li><li><a class="tocitem" href="../config/">Configuration</a></li><li><a class="tocitem" href="../parameters/">Parameters</a></li><li><a class="tocitem" href="../longruns/">Longruns</a></li><li><a class="tocitem" href="../api/">API</a></li><li><a class="tocitem" href="../references/">References</a></li></ul><div class="docs-version-selector field has-addons"><div class="control"><span class="docs-label button is-static is-size-7">Version</span></div><div class="docs-selector control is-expanded"><div class="select is-fullwidth is-size-7"><select id="documenter-version-selector"></select></div></div></div></nav><div class="docs-main"><header class="docs-navbar"><a class="docs-sidebar-button docs-navbar-link fa-solid fa-bars is-hidden-desktop" id="documenter-sidebar-button" href="#"></a><nav class="breadcrumb"><ul class="is-hidden-mobile"><li class="is-active"><a href>Gravity Wave Drag Parameterizations</a></li></ul><ul class="is-hidden-tablet"><li class="is-active"><a href>Gravity Wave Drag Parameterizations</a></li></ul></nav><div class="docs-right"><a class="docs-navbar-link" href="https://github.com/CliMA/ClimaAtmos.jl" title="View the repository on GitHub"><span class="docs-icon fa-brands"></span><span class="docs-label is-hidden-touch">GitHub</span></a><a class="docs-navbar-link" href="https://github.com/CliMA/ClimaAtmos.jl/blob/main/docs/src/gravity_wave.md" title="Edit source on GitHub"><span class="docs-icon fa-solid"></span></a><a class="docs-settings-button docs-navbar-link fa-solid fa-gear" id="documenter-settings-button" href="#" title="Settings"></a><a class="docs-article-toggle-button fa-solid fa-chevron-up" id="documenter-article-toggle-button" href="javascript:;" title="Collapse all docstrings"></a></div></header><article class="content" id="documenter-page"><h1 id="Gravity-wave-parameterization"><a class="docs-heading-anchor" href="#Gravity-wave-parameterization">Gravity wave parameterization</a><a id="Gravity-wave-parameterization-1"></a><a class="docs-heading-anchor-permalink" href="#Gravity-wave-parameterization" title="Permalink"></a></h1><p>Gravity waves have a great impact on the atmospheric circulation. They are usually generated from topography or convection, propagate upward and alter temperature and winds in the middle atmosphere, and influence tropospheric circulation through downward control. The horizontal wavelength for gravity waves ranges from several kilometers to hundreds of kilometers, which is smaller than typical GCM resolution and needs to be parameterized.</p><p>The gravity wave drag on the wind velocities (<span>$\overline{\vec{v}}=(u,v)$</span>) are </p><p class="math-container">\[\frac{\partial \overline{\vec{v}}}{ \partial t} = ... - \underbrace{\frac{\partial \overline{\vec{v}&#39;w&#39;}}{\partial z}\Big|_{GW} }_{\vec{X}} \]</p><p>with <span>$\vec{X} = (X_\lambda, X_\phi)$</span> representing the sub-grid scale zonal and meridional components of the gravity wave drag and is calculated with the parameterization. </p><h2 id="Non-orographic-gravity-wave"><a class="docs-heading-anchor" href="#Non-orographic-gravity-wave">Non-orographic gravity wave</a><a id="Non-orographic-gravity-wave-1"></a><a class="docs-heading-anchor-permalink" href="#Non-orographic-gravity-wave" title="Permalink"></a></h2><p>The non-orographic gravity wave drag parameterization follows the spectra methods described in [<a href="../references/#alexander1999">1</a>]. The following assumptions are made for this parameterization to work:</p><ul><li>The wave spectrum consists of independent monochromatic waves, and wave-wave interaction is neglected when propagation and instability is computed.</li><li>The gravity wave propagates vertically and conservatively to the breaking level and deposits all momentum flux into that level, as opposed to the method using saturation profile described in [<a href="../references/#lindzen1981">2</a>].</li><li>The wave breaking criterion is derived in a hydrostatic, non-rotating frame. Including non-hydrostatic and rotation is proved to have negligible impacts.</li><li>The gravity wave is intermittent and the intermittency is computed as the ratio of the total long-term average source to the integral of the source momentum flux spectrum.</li></ul><h3 id="Spectrum-of-the-momentum-flux-sources"><a class="docs-heading-anchor" href="#Spectrum-of-the-momentum-flux-sources">Spectrum of the momentum flux sources</a><a id="Spectrum-of-the-momentum-flux-sources-1"></a><a class="docs-heading-anchor-permalink" href="#Spectrum-of-the-momentum-flux-sources" title="Permalink"></a></h3><p>The source spectrum with respect to phase speed is prescribed in Eq. (17) in [<a href="../references/#alexander1999">1</a>]. We adapt the equation so that the spectrum writes as a combination of a wide and a narrow band as</p><p class="math-container">\[B_0(c) = \frac{F_{S0}(c)}{\rho_0} = sgn(c-u_0) \left( Bm\_w \exp\left[ -\left( \frac{c-c_0}{c_{w\_w}} \right) \ln{2} \right] + Bm\_n \exp\left[ -\left( \frac{c-c_0}{c_{w\_n}} \right) \ln{2} \right] \right)\]</p><p>where the subscript <span>$0$</span> denotes values at the source level. <span>$c_0$</span> is the phase speed with the maximum flux magnitude <span>$Bm$</span>. <span>$c_w$</span> is the half-width at half-maximum of the Gaussian.  <span>$\_w$</span> and <span>$\_n$</span> represent the wide and narrow bands of the spectra.</p><h3 id="Upward-propagation-and-wave-breaking"><a class="docs-heading-anchor" href="#Upward-propagation-and-wave-breaking">Upward propagation and wave breaking</a><a id="Upward-propagation-and-wave-breaking-1"></a><a class="docs-heading-anchor-permalink" href="#Upward-propagation-and-wave-breaking" title="Permalink"></a></h3><p>Waves that are reflected will be removed from the spectrum. A wave that breaks at a level above the source will deposit all its momentum flux into that level and be removed from the spectrum.</p><p>The reflection frequency is defined as</p><p class="math-container">\[\omega_r(z) = (\frac{N(z)^2 k^2}{k^2+\alpha^2})^{1/2}\]</p><p>where <span>$N(z)$</span> is the buoyancy frequency, <span>$k$</span> is the horizontal wavenumber that corresponds to a wavelength of 300 km, <span>$\alpha = 1/H$</span> where <span>$H$</span> is the scale height. <span>$\omega_r(z)$</span> is used to determine for each monochromatic wave in the spectrum, whether it will be reflected at height <span>$z$</span>.</p><p>The instability condition is defined as</p><p class="math-container">\[Q(z,c) = \frac{\rho_0}{\rho(z)} \frac{2N(z)B_0(c)}{k[c-u(z)]^3}\]</p><p><span>$Q(z,c)$</span> is used to determine whether the monochromatic wave of phase speed <span>$c$</span> gets unstable at height <span>$z$</span>. </p><ul><li><p>At the source level</p><ul><li>if <span>$|\omega|=k|c-u_0| \geq \omega_r$</span>, this wave would have undergone internal reflection somewhere below and is removed from the spectrum;</li><li>if <span>$Q(z_0, c) \geq 1$</span>, it is also removed because it is not stable at the source level.</li></ul></li><li><p>At the levels above <span>$(z_n&gt;z_0)$</span>, <span>$|\omega(z_n)|=k|c-u(z_n)| \geq \omega_r(z_n)$</span> is removed from the spectrum. In the remaining speed, <span>$Q(z_n,c) \geq 1$</span> are breaking between level <span>$z_{n-1}$</span> and <span>$z_n$</span>, and this portion of momentum flux is all deposited between <span>$z_{n-1}$</span> and <span>$z_n$</span>, which yields</p><p class="math-container">\[X(z_{n-1/2}) = \frac{\epsilon \rho_0}{\rho(z_{n-1/2)}}\Sigma_j (B_0)j.\]</p><p>where <span>$\epsilon=F_{S0}/\rho_0/\Sigma B_0$</span> is the wave intermittency. In computing the intermittency, <span>$F_{S0}$</span> is the time average total momentum flux and is prescribed as latitude dependent properties.  And we get </p><p class="math-container">\[X(z_{n-1}) = 0.5*\left[X(z_{n-3/2}) +X(z_{n-1/2}) \right].\]</p></li></ul><p>By applying the above parameterization on zonal and meridional winds, the forcing for the physical wind velocity is computed. We further transform them onto the Covariant vectors and that will be the tendencied added onto the momentum equation.</p><h2 id="Orographic-gravity-wave"><a class="docs-heading-anchor" href="#Orographic-gravity-wave">Orographic gravity wave</a><a id="Orographic-gravity-wave-1"></a><a class="docs-heading-anchor-permalink" href="#Orographic-gravity-wave" title="Permalink"></a></h2><p>The orographic gravity wave drag parameterization follows the methods described in [<a href="../references/#garner2005">3</a>]. The momentum drag from sub-grid scale mountains is divided into a non-propagating component and a propagating component. The non-propagating component forces momentum drag within the planetary boundary layer while the propagating component generate a <code>c=0</code> gravity wave which propagates upwards and deposit momentum flux to the layers where it breaks.</p><h3 id="PBL-top"><a class="docs-heading-anchor" href="#PBL-top">PBL top</a><a id="PBL-top-1"></a><a class="docs-heading-anchor-permalink" href="#PBL-top" title="Permalink"></a></h3><p>There are many ways to determine the PBL top. We implement the following simple criteria to find the PBL top level k as the highest level that satisfies</p><p class="math-container">\[^c p[k] \ge 0.5 ∗ ^f p[0]\]</p><p>and</p><p class="math-container">\[^c T[0] + T_{boost} - ^c T[k] &gt; g/c_p * ( ^c z[k] - ^c z[0] )\]</p><p>where the superscripts <span>$f$</span> and <span>$c$</span> represent cell faces and cell centers in the vertical stencils. <span>$T_{boost} = 1.5 \mathrm{K}$</span> is the surface temperature boost to improve PBL height estimate.</p><h3 id="Orographic-information"><a class="docs-heading-anchor" href="#Orographic-information">Orographic information</a><a id="Orographic-information-1"></a><a class="docs-heading-anchor-permalink" href="#Orographic-information" title="Permalink"></a></h3><p>The orographic information needed in generating the base momentum flux for low-level flow encountering the sub-grid scale mountains. We compute the tensor <span>$\textbf{T}$</span> and the scalar <span>$h_{max}$</span> from the Earth elevation data (GFDL codes <a href="https://caltech.box.com/s/w4szffattzofarpwyv9rmm5s77jgo3o4">here</a>).</p><h4 id="Tensor-\\textbf{T}"><a class="docs-heading-anchor" href="#Tensor-\\textbf{T}">Tensor <span>$\textbf{T}$</span></a><a id="Tensor-\\textbf{T}-1"></a><a class="docs-heading-anchor-permalink" href="#Tensor-\\textbf{T}" title="Permalink"></a></h4><p>The tensor <span>$\textbf{T}$</span>, which contains all relevant information including amplitude, variance, orientation, and anisotropy about topography, is computed as</p><p class="math-container">\[\textbf{T} = \nabla \chi (\nabla h)^T,\]</p><p>where <span>$h$</span> is the earth elevation, and <span>$\chi = - \frac{\rho N}{2\pi} \frac{h(x&#39;)}{|x-x&#39;|} \int \int dx&#39; dy&#39;$</span> is the velocity potential.</p><h4 id="h_max"><a class="docs-heading-anchor" href="#h_max"><span>$h_max$</span></a><a id="h_max-1"></a><a class="docs-heading-anchor-permalink" href="#h_max" title="Permalink"></a></h4><p><span>$h_max$</span> represents the relation between the local elevation with its surroundings. It is computed as the <span>$4th$</span> moments of the local elevation with a certain area.</p><h3 id="Base-flux"><a class="docs-heading-anchor" href="#Base-flux">Base flux</a><a id="Base-flux-1"></a><a class="docs-heading-anchor-permalink" href="#Base-flux" title="Permalink"></a></h3><p>The base momentum flux generated is computed and divided into the propagating and non-propagating components.</p><p>Let <span>$\overline{\cdot}$</span> represents the mean property of the low-level flow which can be obtained as either the average within PBL or the value at the first cell center right above PBL top. Let <span>$\overline{V} = (\overline{u}, \overline{v})$</span>, <span>$\overline{N}$</span>, and <span>$\overline{\rho}$</span> represent the horizontal wind, buoyancy frequency, and density of the low-level flow. <span>$\overline{N}$</span> is computed as </p><p class="math-container">\[\overline{N} ^2 = \frac{g}{\overline{T}} * \left( \overline{\frac{dT}{dz}} + \frac{g}{c_p} \right).\]</p><p>The base flux is computed as the linear drag following</p><p class="math-container">\[\tau = \overline{\rho} \overline{N} \langle \textbf{T} \rangle ^T \overline{V},\]</p><p>where <span>$\langle \textbf{T} \rangle = [t_{11}, t_{12}; t_{21}, t_{22}]$</span> is the tensor that contains orographic information. In the code, we compute the zonal and meridional components separately as </p><p class="math-container">\[\tau_x = \overline{\rho} \overline{N} (t_{11} \overline{u} + t_{21} \overline{v}),\]</p><p class="math-container">\[\tau_y = \overline{\rho} \overline{N} (t_{12} \overline{u} + t_{22} \overline{v}).\]</p><p>The base flux is then corrected using Froude number and saturation velocity. Let</p><p class="math-container">\[V_{\tau} = \max(\epsilon_0, - \overline{V} \cdot \frac{\tau}{|\tau|}),\]</p><p>and given the orographic information <span>$h_{max}$</span> and <span>$h_{min}$</span>, the max and min Froude numbers are computed as</p><p class="math-container">\[Fr_{max} = h_{max} \frac{\overline{N}}{V_{\tau}},\]</p><p class="math-container">\[Fr_{min} = h_{min} \frac{\overline{N}}{V_{\tau}}.\]</p><p>We also compute the med Froude number as</p><p class="math-container">\[Fr_{med} = Fr_{crit} + Fr_{int},\]</p><p>where <span>$Fr_{crit} = 0.7$</span> is the critical Froude number for nonlinear flow, <span>$Fr_{int} = 0.5$</span> is an arbitrary parameter.</p><p>The saturation velocity is computed as</p><p class="math-container">\[U_{sat} = \sqrt{\frac{\overline{\rho}}{\rho_0} \frac{V_{\pmb{\tau}}^3}{\overline{N} L_0}},\]</p><p>where <span>$\rho_0 = 1.2 \mathrm{kg/m^3}$</span> is the arbitrary density scale, and <span>$L_0 = 80e3 \mathrm{m}$</span> is the arbitrary horizontal length scale. </p><p>The following set of intermediate variables (<span>$FrU$</span>&#39;s) are computed to correct the linear base flux:</p><p class="math-container">\[FrU_{sat} = Fr_{crit} * U_{sat},\]</p><p class="math-container">\[FrU_{min} = Fr_{min} * U_{sat},\]</p><p class="math-container">\[FrU_{med} = Fr_{med} * U_{sat},\]</p><p class="math-container">\[FrU_{max} = \max(Fr_{max} * U_{sat}, FrU_{min} + \epsilon_0),\]</p><p class="math-container">\[FrU_{clp} = \min(FrU_{max}, \max(FrU_{min}, FrU_{sat})),\]</p><p class="math-container">\[FrU_0 = \frac{U_0}{V_{\tau}}U_{sat},\]</p><p>and <span>$U_0=1.0 \mathrm{m/s}$</span> is the arbitrary velocity scale.</p><p>Now the correct linear drag is computed as </p><p class="math-container">\[\tau_l = \frac{FrU_{max}^{2+\gamma-\epsilon} - FrU_{min}^{2+\gamma-\epsilon}}{2+\gamma-\epsilon},\]</p><p>and the propagating and non-propagating parts of the drag are computed as</p><p class="math-container">\[\tau_p = a_0 \left[ \frac{FrU_{clp}^{2+\gamma-\epsilon} - FrU_{min}^{2+\gamma-\epsilon}}{2+\gamma-\epsilon} + FrU_{sat}^{\beta+2} \frac{FrU_{max}^{\gamma-\epsilon-\beta} - FrU_{clp}^{\gamma-\epsilon-\beta}}{\gamma-\epsilon-\beta} \right],\]</p><p class="math-container">\[\tau_{np} = a_1 \frac{U_{sat}}{1+\beta} \left[ \frac{FrU_{max}^{1+\gamma-\epsilon} - FrU_{clp}^{1+\gamma-\epsilon}}{1+\gamma-\epsilon} - FrU_{sat}^{\beta+1} \frac{FrU_{\max}^{\gamma-\epsilon-\beta} - FrU_{clp}^{\gamma-\epsilon-\beta}}{\gamma-\epsilon-\beta} \right].\]</p><p>Here, <span>$(\gamma, \epsilon, \beta) = (0.4, 0.0, 0.5)$</span> are arbitrary parameters that describe the mountain shapes.</p><h3 id="Saturation-profiles-for-the-propagating-component"><a class="docs-heading-anchor" href="#Saturation-profiles-for-the-propagating-component">Saturation profiles for the propagating component</a><a id="Saturation-profiles-for-the-propagating-component-1"></a><a class="docs-heading-anchor-permalink" href="#Saturation-profiles-for-the-propagating-component" title="Permalink"></a></h3><p>The vertical profiles of saturated momentum flux <span>$\tau_{sat}$</span> is computed then so that momentum forcing can be obtained for <span>$d\overline{V}/dt = -\overline{\rho}^{-1}d\tau_{sat}/dz$</span>. This only applies to the propagating part.</p><p>Similar to the base flux calculation but for the 3D fields, we computed <span>$N$</span> and <span>$V_\tau$</span> at cell faces as</p><p class="math-container">\[^f N[k]^2 = \frac{g}{^f T[k]} * ( ^f \overline{\frac{dT}{dz}}[k] + \frac{g}{cp}),\]</p><p class="math-container">\[^f V_{\tau}[k] = \max(\epsilon_0, - V[k] \cdot \frac{\tau}{|\tau|}).\]</p><p>Let <span>$L_1 = L_0 * \max(0.5, \min(2.0, 1.0-samp*V_\tau*d^2V_{\tau}/N^2))$</span> where <span>$samp=1.0$</span> is the correction for coarse sampling of <span>$d^2V/dz^2$</span>, and</p><p class="math-container">\[^f d^2V_{\tau}[k] = - \frac{d^2 V}{dz^2}[k] \cdot \frac{\tau}{|\tau|}.\]</p><p>The saturated velocity <span>$U_{sat}$</span> is refined as follows and used to computed the intermediate <span>$FrU&#39;s$</span></p><p class="math-container">\[U_{sat} = \min(U_{sat}, \sqrt{\frac{^\mathrm{f} \rho}{\rho_0} \frac{^\mathrm{f} V_{\pmb{\tau}}^3}{^\mathrm{f}N L_1} }).\]</p><p>The <span>$FrU_{min}$</span> and <span>$FrU_{max}$</span> are inherited from the base flux calculation. Let&#39;s save the source level <span>$FrU_{sat}$</span> and <span>$FrU_{clp}$</span> into</p><p class="math-container">\[FrU_{sat0} = FrU_{sat},\]</p><p class="math-container">\[FrU_{clp0} = FrU_{clp},\]</p><p>and update <span>$FrU_{sat}$</span> and <span>$FrU_{clp}$</span> as </p><p class="math-container">\[FrU_{sat} = Fr_{crit} * U_{sat},\]</p><p class="math-container">\[FrU_{clp} = \min(FrU_{\max}, \max(FrU_{\min}, FrU_{sat})).\]</p><p>Then, the saturated profile of propagating component of the momentum flux is </p><p class="math-container">\[\tau_{sat} = a_0 \left[ \frac{FrU_{clp}^{2+\gamma-\epsilon} - FrU_{\min}^{2+\gamma-\epsilon}}{2+\gamma-\epsilon} + FrU_{sat}^2 FrU_{sat0}^\beta \frac{FrU_{\max}^{\gamma-\epsilon-\beta} - FrU_{clp0}^{\gamma-\epsilon-\beta}}{\gamma-\epsilon-\beta} + FrU_{sat}^2 \frac{FrU_{clp0}^{\gamma-\epsilon} - FrU_{clp}^{\gamma-\epsilon}}{\gamma-\epsilon} \right]\]</p><p>If the wave does not break and propagates all the way up to the model top, the residual momentum carried by this part will be redistributed throughout the column weighted by pressure to conserve momentum. That is,</p><p class="math-container">\[\tau_{sat}[k] = \tau_{sat}[k] - \tau_{sat}[end] \frac{^f p[1]-^f p[k]}{^f p[1]-^f p[end]}.\]</p><h3 id="Velocity-tendencies-due-to-the-orographic-drag"><a class="docs-heading-anchor" href="#Velocity-tendencies-due-to-the-orographic-drag">Velocity tendencies due to the orographic drag</a><a id="Velocity-tendencies-due-to-the-orographic-drag-1"></a><a class="docs-heading-anchor-permalink" href="#Velocity-tendencies-due-to-the-orographic-drag" title="Permalink"></a></h3><h4 id="Propagating-component"><a class="docs-heading-anchor" href="#Propagating-component">Propagating component</a><a id="Propagating-component-1"></a><a class="docs-heading-anchor-permalink" href="#Propagating-component" title="Permalink"></a></h4><p>The forcing from the propagating part on the zonal and meridional wind are</p><p class="math-container">\[^c \left( \frac{du}{dt} \right) _p = - \frac{1}{^c \rho} \frac{\tau_x}{\tau_l} \frac{d\tau_{sat}}{dz},\]</p><p class="math-container">\[^c \left( \frac{dv}{dt} \right) _p = - \frac{1}{^c \rho} \frac{\tau_y}{\tau_l} \frac{d\tau_{sat}}{dz}.\]</p><p>Here, <span>$(\tau_x, \tau_y, \tau_l)$</span> is computed in the base flux calculation, and <span>$\tau_{sat}$</span> is calculated in the saturation flux profile. The propagating part functions throughout the entire column.</p><h4 id="Non-propagating-component"><a class="docs-heading-anchor" href="#Non-propagating-component">Non-propagating component</a><a id="Non-propagating-component-1"></a><a class="docs-heading-anchor-permalink" href="#Non-propagating-component" title="Permalink"></a></h4><p>Let&#39;s first find the reference level <span>$kref$</span> below which the non-propagating part functions to decelerate the flow. Let <span>$k$</span> loops from PBL top upwards, initiate <span>$phase = 0.0$</span> and <span>$z_{last} = ^fz[k]$</span>, if <span>$phase \leq \pi$</span> and <span>$k$</span> is below the top level, update <span>$phase$</span> and <span>$z_{last}$</span> as</p><p class="math-container">\[phase += \frac{\max(N_{min}, \min(N_{max}, ^fN[k]))}{\max(vvmin, ^f V_{\tau}[k])} * (^c z[k+1] - z_{last})\]</p><p class="math-container">\[z_{last} = ^c z[k+1]\]</p><p>and move one level up. Here, <span>$N_{min} = 0.7e-2, N_{max}=1.7e-2, vvmin = 1.0$</span>; and <span>$(^f N, ^f V_{\tau})$</span> are computed during the saturation profile calculation. Let <span>$kref=k$</span> when the loop terminates.</p><p>The drag forcing due to non-propagating component functions from the PBL top to the level of <span>$kref$</span> and is weighted by pressure. The weights of each level are computed as</p><p class="math-container">\[weight[k] = ^c p[k] - ^f p[kref],\]</p><p>and the sum of the weights is </p><p class="math-container">\[wtsum += \frac{^f p[k-1] - ^f p[k]}{weight[k]}.\]</p><p>For level <span>$k$</span> between PBL top and <span>$kref$</span>, the forcing due to non-propagating component is</p><p class="math-container">\[^c \left( \frac{du}{dt} [k] \right)_{np} = g \frac{\tau_{np}}{\tau_l} \frac{weight[k]}{wtsum} \tau_x, \]</p><p class="math-container">\[^c \left( \frac{dv}{dt} [k] \right)_{np} = g \frac{\tau_{np}}{\tau_l} \frac{weight[k]}{wtsum} \tau_y, \]</p><p>where <span>$(\tau_x, \tau_y, \tau_l, \tau_{np})$</span> is computed in the base flux calculation.</p><h3 id="Constrain-the-forcings"><a class="docs-heading-anchor" href="#Constrain-the-forcings">Constrain the forcings</a><a id="Constrain-the-forcings-1"></a><a class="docs-heading-anchor-permalink" href="#Constrain-the-forcings" title="Permalink"></a></h3><p>Total drag from both components are</p><p class="math-container">\[^c \left( \frac{du}{dt} [k] \right)_{\tau} = ^c \left( \frac{du}{dt} [k] \right)_{p} + ^c \left( \frac{du}{dt} [k] \right)_{np},\]</p><p class="math-container">\[^c \left( \frac{dv}{dt} [k] \right)_{\tau} = ^c \left( \frac{dv}{dt} [k] \right)_{p} + ^c \left( \frac{dv}{dt} [k] \right)_{np}.\]</p><p>To avoid instability due to large tendencies from the forcing, let&#39;s constrain the forcing magnitude with <span>$\epsilon_V = 3e-3$</span>, and let</p><p class="math-container">\[^c \left( \frac{du}{dt} [k] \right)_{\tau} = \max(-\epsilon_V, \min(\epsilon_V, ^c \left( \frac{du}{dt} [k] \right)_{\pmb{\tau}})),\]</p><p class="math-container">\[^c \left( \frac{dv}{dt} [k] \right)_{\tau} = \max(-\epsilon_V, \min(\epsilon_V, ^c \left( \frac{dv}{dt} [k] \right)_{\pmb{\tau}})).\]</p><p>Here we computed the forcing on the physical velocity (i.e., zonal and meridional wind). They are converted to the Covariant12Vector before being added to <span>$Y_t$</span> in the codes.</p></article><nav class="docs-footer"><a class="docs-footer-prevpage" href="../diagnostic_edmf_equations/">« Diagnostic EDMF Equations</a><a class="docs-footer-nextpage" href="../surface_albedo/">Ocean Surface Albedo Parameterization »</a><div class="flexbox-break"></div><p class="footer-message">Powered by <a href="https://github.com/JuliaDocs/Documenter.jl">Documenter.jl</a> and the <a href="https://julialang.org/">Julia Programming Language</a>.</p></nav></div><div class="modal" id="documenter-settings"><div class="modal-background"></div><div class="modal-card"><header class="modal-card-head"><p class="modal-card-title">Settings</p><button class="delete"></button></header><section class="modal-card-body"><p><label class="label">Theme</label><div class="select"><select id="documenter-themepicker"><option value="auto">Automatic (OS)</option><option value="documenter-light">documenter-light</option><option value="documenter-dark">documenter-dark</option></select></div></p><hr/><p>This document was generated with <a href="https://github.com/JuliaDocs/Documenter.jl">Documenter.jl</a> version 1.4.1 on <span class="colophon-date" title="Tuesday 4 June 2024 21:09">Tuesday 4 June 2024</span>. Using Julia version 1.10.4.</p></section><footer class="modal-card-foot"></footer></div></div></div></body></html>
