<!DOCTYPE html>
<html lang="en"><head><meta charset="UTF-8"/><meta name="viewport" content="width=device-width, initial-scale=1.0"/><title>EDMF Equations · ClimaAtmos.jl</title><meta name="title" content="EDMF Equations · ClimaAtmos.jl"/><meta property="og:title" content="EDMF Equations · ClimaAtmos.jl"/><meta property="twitter:title" content="EDMF Equations · ClimaAtmos.jl"/><meta name="description" content="Documentation for ClimaAtmos.jl."/><meta property="og:description" content="Documentation for ClimaAtmos.jl."/><meta property="twitter:description" content="Documentation for ClimaAtmos.jl."/><script data-outdated-warner src="../assets/warner.js"></script><link href="https://cdnjs.cloudflare.com/ajax/libs/lato-font/3.0.0/css/lato-font.min.css" rel="stylesheet" type="text/css"/><link href="https://cdnjs.cloudflare.com/ajax/libs/juliamono/0.050/juliamono.min.css" rel="stylesheet" type="text/css"/><link href="https://cdnjs.cloudflare.com/ajax/libs/font-awesome/6.4.2/css/fontawesome.min.css" rel="stylesheet" type="text/css"/><link href="https://cdnjs.cloudflare.com/ajax/libs/font-awesome/6.4.2/css/solid.min.css" rel="stylesheet" type="text/css"/><link href="https://cdnjs.cloudflare.com/ajax/libs/font-awesome/6.4.2/css/brands.min.css" rel="stylesheet" type="text/css"/><link href="https://cdnjs.cloudflare.com/ajax/libs/KaTeX/0.16.8/katex.min.css" rel="stylesheet" type="text/css"/><script>documenterBaseURL=".."</script><script src="https://cdnjs.cloudflare.com/ajax/libs/require.js/2.3.6/require.min.js" data-main="../assets/documenter.js"></script><script src="../search_index.js"></script><script src="../siteinfo.js"></script><script src="../../versions.js"></script><link class="docs-theme-link" rel="stylesheet" type="text/css" href="../assets/themes/documenter-dark.css" data-theme-name="documenter-dark" data-theme-primary-dark/><link class="docs-theme-link" rel="stylesheet" type="text/css" href="../assets/themes/documenter-light.css" data-theme-name="documenter-light" data-theme-primary/><script src="../assets/themeswap.js"></script></head><body><div id="documenter"><nav class="docs-sidebar"><div class="docs-package-name"><span class="docs-autofit"><a href="../">ClimaAtmos.jl</a></span></div><button class="docs-search-query input is-rounded is-small is-clickable my-2 mx-auto py-1 px-2" id="documenter-search-query">Search docs (Ctrl + /)</button><ul class="docs-menu"><li><a class="tocitem" href="../">Home</a></li><li><a class="tocitem" href="../installation_instructions/">Installation instructions</a></li><li><a class="tocitem" href="../contributor_guide/">Contributor Guide</a></li><li><a class="tocitem" href="../equations/">Equations</a></li><li class="is-active"><a class="tocitem" href>EDMF Equations</a><ul class="internal"><li><a class="tocitem" href="#Dycore-variables"><span>Dycore variables</span></a></li><li><a class="tocitem" href="#Prognostic-variables"><span>Prognostic variables</span></a></li><li><a class="tocitem" href="#Operators"><span>Operators</span></a></li><li><a class="tocitem" href="#Auxiliary-and-derived-quantities"><span>Auxiliary and derived quantities</span></a></li><li><a class="tocitem" href="#Equations-and-discretizations"><span>Equations and discretizations</span></a></li></ul></li><li><a class="tocitem" href="../diagnostics/">Diagnostics</a></li><li><a class="tocitem" href="../available_diagnostics/">Available Diagnostics</a></li><li><a class="tocitem" href="../diagnostic_edmf_equations/">Diagnostic EDMF Equations</a></li><li><a class="tocitem" href="../gravity_wave/">Gravity Wave Drag Parameterizations</a></li><li><a class="tocitem" href="../radiative_equilibrium/">Radiative Equilibrium</a></li><li><a class="tocitem" href="../repl_scripts/">REPL scripts</a></li><li><a class="tocitem" href="../config/">Configuration</a></li><li><a class="tocitem" href="../parameters/">Parameters</a></li><li><a class="tocitem" href="../api/">API</a></li><li><a class="tocitem" href="../references/">References</a></li></ul><div class="docs-version-selector field has-addons"><div class="control"><span class="docs-label button is-static is-size-7">Version</span></div><div class="docs-selector control is-expanded"><div class="select is-fullwidth is-size-7"><select id="documenter-version-selector"></select></div></div></div></nav><div class="docs-main"><header class="docs-navbar"><a class="docs-sidebar-button docs-navbar-link fa-solid fa-bars is-hidden-desktop" id="documenter-sidebar-button" href="#"></a><nav class="breadcrumb"><ul class="is-hidden-mobile"><li class="is-active"><a href>EDMF Equations</a></li></ul><ul class="is-hidden-tablet"><li class="is-active"><a href>EDMF Equations</a></li></ul></nav><div class="docs-right"><a class="docs-navbar-link" href="https://github.com/CliMA/ClimaAtmos.jl" title="View the repository on GitHub"><span class="docs-icon fa-brands"></span><span class="docs-label is-hidden-touch">GitHub</span></a><a class="docs-navbar-link" href="https://github.com/CliMA/ClimaAtmos.jl/blob/main/docs/src/edmf_equations.md" title="Edit source on GitHub"><span class="docs-icon fa-solid"></span></a><a class="docs-settings-button docs-navbar-link fa-solid fa-gear" id="documenter-settings-button" href="#" title="Settings"></a><a class="docs-article-toggle-button fa-solid fa-chevron-up" id="documenter-article-toggle-button" href="javascript:;" title="Collapse all docstrings"></a></div></header><article class="content" id="documenter-page"><h1 id="Sub-grid-scale-equations"><a class="docs-heading-anchor" href="#Sub-grid-scale-equations">Sub-grid scale equations</a><a id="Sub-grid-scale-equations-1"></a><a class="docs-heading-anchor-permalink" href="#Sub-grid-scale-equations" title="Permalink"></a></h1><p>This describes the EDMF scheme equations and its discretizations. Where possible, we use a coordinate invariant form: the ClimaCore operators generally handle the conversions between bases internally.</p><h2 id="Dycore-variables"><a class="docs-heading-anchor" href="#Dycore-variables">Dycore variables</a><a id="Dycore-variables-1"></a><a class="docs-heading-anchor-permalink" href="#Dycore-variables" title="Permalink"></a></h2><ul><li><span>$\boldsymbol{\Omega}$</span> is the planetary angular velocity. We currently use a shallow-atmosphere approximation, with<p class="math-container">\[\boldsymbol{\Omega} = \Omega \sin(\phi) \boldsymbol{e}^v\]</p>where <span>$\phi$</span> is latitude, and <span>$\Omega$</span> is the planetary rotation rate in rads/sec (for Earth, <span>$7.29212 \times 10^{-5} s^{-1}$</span>) and <span>$\boldsymbol{e}^v$</span> is the unit radial basis vector. This implies that the horizontal contravariant component <span>$\boldsymbol{\Omega}^h$</span> is zero.</li><li><span>$\boldsymbol{u}_h = u_1 \boldsymbol{e}^1 + u_2 \boldsymbol{e}^2$</span> is the projection onto horizontal covariant components (covariance here means with respect to the reference element), stored at cell centers.</li><li><span>$\Phi = g z$</span> is the geopotential, where <span>$g$</span> is the gravitational acceleration rate and <span>$z$</span> is altitude above the mean sea level.</li><li><span>$\rho_{\text{ref}}$</span> is the reference state density</li><li><span>$p$</span> is air pressure, derived from the thermodynamic state, reconstructed at cell centers.</li><li><span>$p_{\text{ref}}$</span> is the reference state pressure. It is related to the reference state density by analytical hydrostatic balance: <span>$\nabla p_{\text{ref}} = - \rho_{\text{ref}} \nabla \Phi$</span>.</li></ul><h2 id="Prognostic-variables"><a class="docs-heading-anchor" href="#Prognostic-variables">Prognostic variables</a><a id="Prognostic-variables-1"></a><a class="docs-heading-anchor-permalink" href="#Prognostic-variables" title="Permalink"></a></h2><ul><li><span>$\hat{\rho}^j$</span>: <em>effective density</em> in kg/m³. Superscript <span>$j$</span> represents the sub-domain. <span>$\hat{\rho}^j = \rho^j a^j$</span> where <span>$\rho^j$</span> is the sub-domain density and <span>$a^j$</span> is the sub-domain area fraction. This is discretized at cell centers.</li><li><span>$\boldsymbol{u}^j$</span> <em>velocity</em>, a vector in m/s. This is discretized via <span>$\boldsymbol{u}^j = \boldsymbol{u}_h + \boldsymbol{u}_v^j$</span> where<ul><li><span>$\boldsymbol{u}_v^j = u_3^j \boldsymbol{e}^3$</span> is the projection onto the vertical covariant components, stored at cell faces.</li></ul></li><li><span>$\hat{\rho}^j e^j$</span>: <em>total energy</em> in J/m³. This is discretized at cell centers.</li><li><span>$\hat{\rho}^j q^j$</span>: moisture tracers. <span>$q^j$</span> stands for the sub-domain total (liquid, ice, rain, snow) specific humidity in kg/kg. This is stored at cell centers.</li><li><span>$\hat{\rho}^j \chi^j$</span>: other tracers (aerosol, ...), again stored at cell centers.</li></ul><h2 id="Operators"><a class="docs-heading-anchor" href="#Operators">Operators</a><a id="Operators-1"></a><a class="docs-heading-anchor-permalink" href="#Operators" title="Permalink"></a></h2><p>We make use of the following operators</p><h3 id="Reconstruction"><a class="docs-heading-anchor" href="#Reconstruction">Reconstruction</a><a id="Reconstruction-1"></a><a class="docs-heading-anchor-permalink" href="#Reconstruction" title="Permalink"></a></h3><ul><li><span>$I^c$</span> is the <a href="https://clima.github.io/ClimaCore.jl/stable/operators/#ClimaCore.Operators.InterpolateF2C">face-to-center reconstruction operator</a> (arithmetic mean)</li><li><span>$I^f$</span> is the <a href="https://clima.github.io/ClimaCore.jl/stable/operators/#ClimaCore.Operators.InterpolateC2F">center-to-face reconstruction operator</a> (arithmetic mean)</li><li><span>$WI^f$</span> is the <a href="https://clima.github.io/ClimaCore.jl/stable/operators/#ClimaCore.Operators.WeightedInterpolateC2F">center-to-face weighted reconstruction operator</a><ul><li><span>$WI^f(J, x) = I^f(J*x) / I^f(J)$</span>, where <span>$J$</span> is the value of the Jacobian for use in the weighted interpolation operator</li></ul></li><li><span>$U^f$</span> is the <a href="https://clima.github.io/ClimaCore.jl/stable/operators/#ClimaCore.Operators.Upwind3rdOrderBiasedProductC2F">1st or 3rd-order center-to-face upwind product operator</a> # fix link</li></ul><h3 id="Differential-operators"><a class="docs-heading-anchor" href="#Differential-operators">Differential operators</a><a id="Differential-operators-1"></a><a class="docs-heading-anchor-permalink" href="#Differential-operators" title="Permalink"></a></h3><ul><li><span>$D_h$</span> is the <a href="https://clima.github.io/ClimaCore.jl/stable/operators/#ClimaCore.Operators.Divergence">discrete horizontal spectral divergence</a>.</li><li><span>$\hat{\mathcal{D}}_h$</span> is the <a href="https://clima.github.io/ClimaCore.jl/stable/operators/#ClimaCore.Operators.WeakDivergence">discrete horizontal spectral weak divergence</a>.</li><li><span>$D^c_v$</span> is the <a href="https://clima.github.io/ClimaCore.jl/stable/operators/#ClimaCore.Operators.DivergenceF2C">face-to-center vertical divergence</a>.</li><li><span>$G_h$</span> is the <a href="https://clima.github.io/ClimaCore.jl/stable/operators/#ClimaCore.Operators.Gradient">discrete horizontal spectral gradient</a>.</li><li><span>$G^f_v$</span> is the <a href="https://clima.github.io/ClimaCore.jl/stable/operators/#ClimaCore.Operators.GradientC2F">center-to-face vertical gradient</a>.<ul><li>the gradient is set to 0 at the top and bottom boundaries.</li></ul></li><li><span>$C_h$</span> is the <a href="https://clima.github.io/ClimaCore.jl/stable/operators/#ClimaCore.Operators.Curl">curl components involving horizontal derivatives</a><ul><li><span>$C_h[\boldsymbol{u}_h]$</span> returns a vector with only vertical <em>contravariant</em> components.</li><li><span>$C_h[\boldsymbol{u}_v]$</span> returns a vector with only horizontal <em>contravariant</em> components.</li></ul></li><li><span>$\hat{\mathcal{C}}_h$</span> is the <a href="https://clima.github.io/ClimaCore.jl/stable/operators/#ClimaCore.Operators.WeakCurl">weak curl components involving horizontal derivatives</a></li><li><span>$C^f_v$</span> is the <a href="https://clima.github.io/ClimaCore.jl/stable/operators/#ClimaCore.Operators.CurlC2F">center-to-face curl involving vertical derivatives</a>.<ul><li><span>$C^f_v[\boldsymbol{u}_h]$</span> returns a vector with only a horizontal <em>contravariant</em> component.</li><li>the curl is set to 0 at the top and bottom boundaries.<ul><li>We need to clarify how best to handle this.</li></ul></li></ul></li></ul><h3 id="Projection"><a class="docs-heading-anchor" href="#Projection">Projection</a><a id="Projection-1"></a><a class="docs-heading-anchor-permalink" href="#Projection" title="Permalink"></a></h3><ul><li><span>$\mathcal{P}$</span> is the <a href="https://clima.github.io/ClimaCore.jl/stable/operators/#DSS">direct stiffness summation (DSS) operation</a>, which computes the projection onto the continuous spectral element basis.</li></ul><h2 id="Auxiliary-and-derived-quantities"><a class="docs-heading-anchor" href="#Auxiliary-and-derived-quantities">Auxiliary and derived quantities</a><a id="Auxiliary-and-derived-quantities-1"></a><a class="docs-heading-anchor-permalink" href="#Auxiliary-and-derived-quantities" title="Permalink"></a></h2><ul><li><span>$\tilde{\boldsymbol{u}^j}$</span> is the mass-weighted reconstruction of velocity at the interfaces: by interpolation of contravariant components<p class="math-container">\[\tilde{\boldsymbol{u}^j} = WI^f(\rho^j J, \boldsymbol{u}_h) + \boldsymbol{u}_v^j\]</p></li></ul><p>Technically, from mass conservation, the weighting factor should be <span>$\hat{\rho}^j J$</span>. However, in order to avoid issues coming from close to zero sub-domain area fractions, we can instead use <span>$\rho^j J$</span> or even <span>$\rho J$</span>.</p><ul><li><p><span>$\bar{\boldsymbol{u}}^j$</span> is the reconstruction of velocity at cell-centers, carried out by linear interpolation of the covariant vertical component:</p><p class="math-container">\[\bar{\boldsymbol{u}}^j = \boldsymbol{u}_h + I_{c}(\boldsymbol{u}_v^j)\]</p></li><li><p><span>$\boldsymbol{b}^j$</span> is the reduced gravitational acceleration</p><p class="math-container">\[\boldsymbol{b}^j = - \frac{\rho^j - \rho_{\text{ref}}}{\rho^j} \nabla \Phi\]</p></li><li><p><span>$K^j = \tfrac{1}{2} \|\boldsymbol{u}^j\|^2$</span> is the specific kinetic energy (J/kg), reconstructed at cell centers by</p><p class="math-container">\[K^j = \tfrac{1}{2} (\boldsymbol{u}_{h}^j \cdot \boldsymbol{u}_{h}^j + 2 \boldsymbol{u}_{h}^j \cdot I_{c} (\boldsymbol{u}_{v}^j) + I_{c}(\boldsymbol{u}_{v}^j \cdot \boldsymbol{u}_{v}^j)),\]</p><p>where <span>$\boldsymbol{u}_{h}^j$</span> is defined on cell-centers, <span>$\boldsymbol{u}_{v}^j$</span> is defined on cell-faces, and <span>$I_{c} (\boldsymbol{u}_{v})$</span> is interpolated using covariant components.</p></li><li><p><span>$\nu_u$</span>, <span>$\nu_h$</span>, and <span>$\nu_\chi$</span> are hyperdiffusion coefficients, and <span>$c$</span> is the divergence damping factor.</p></li><li><p>No-flux boundary conditions are enforced by requiring the third contravariant component of the face-valued velocity at the boundary, <span>$\boldsymbol{\tilde{u}}^{v,j}$</span>, to be zero. The vertical covariant velocity component is computed as</p><p class="math-container">\[\tilde{u}_{v}^j = - \tfrac{u_{1}g^{31} + u_{2}g^{32}}{g^{33}}.\]</p></li></ul><h2 id="Equations-and-discretizations"><a class="docs-heading-anchor" href="#Equations-and-discretizations">Equations and discretizations</a><a id="Equations-and-discretizations-1"></a><a class="docs-heading-anchor-permalink" href="#Equations-and-discretizations" title="Permalink"></a></h2><h3 id="Mass"><a class="docs-heading-anchor" href="#Mass">Mass</a><a id="Mass-1"></a><a class="docs-heading-anchor-permalink" href="#Mass" title="Permalink"></a></h3><p>Follows the continuity equation</p><p class="math-container">\[\frac{\partial}{\partial t} \hat{\rho}^j = - \nabla \cdot (\hat{\rho}^j \boldsymbol{u}^j)  + RHS\]</p><p>This is discretized using the following</p><p class="math-container">\[\frac{\partial}{\partial t} \hat{\rho}^j
= - D_h[ \hat{\rho}^j (\boldsymbol{u}_h + I^c(\boldsymbol{u}_v^j))] - D^c_v \left[WI^f( J, \hat{\rho}^j) \tilde{\boldsymbol{u}^j} \right] + RHS\]</p><h3 id="Momentum"><a class="docs-heading-anchor" href="#Momentum">Momentum</a><a id="Momentum-1"></a><a class="docs-heading-anchor-permalink" href="#Momentum" title="Permalink"></a></h3><p>Uses the advective form equation</p><p class="math-container">\[\frac{\partial}{\partial t} \boldsymbol{u}^j  = - (2 \boldsymbol{\Omega} + \nabla \times \boldsymbol{u}^j) \times \boldsymbol{u}^j - \frac{1}{\rho^j} \nabla (p - p_{\text{ref}})  + \boldsymbol{b}^j - \nabla K^j + RHS\]</p><p>By breaking the curl and cross product terms into horizontal and vertical contributions, and removing zero terms (e.g. <span>$\nabla_v  \times \boldsymbol{u}_v = 0$</span>), we obtain the vertical momentum equation. The horizontal momentum equation is only solved in the grid-mean.</p><h4 id="Vertical-momentum"><a class="docs-heading-anchor" href="#Vertical-momentum">Vertical momentum</a><a id="Vertical-momentum-1"></a><a class="docs-heading-anchor-permalink" href="#Vertical-momentum" title="Permalink"></a></h4><p class="math-container">\[\frac{\partial}{\partial t} \boldsymbol{u}_v^j  =
  - (\nabla_v \times \boldsymbol{u}_h + \nabla_h \times \boldsymbol{u}_v^j) \times \boldsymbol{u}^h
  - \frac{1}{\rho^j} \nabla_v (p - p_{\text{ref}}) - \frac{\rho^j - \rho_{\text{ref}}}{\rho^j} \nabla_v \Phi - \nabla_v K^j + RHS .\]</p><p>This is stabilized with the addition of 4th-order vector hyperviscosity</p><p class="math-container">\[-\nu_u \nabla_h^2(\nabla_h^2(\boldsymbol{u}^j)),\]</p><p>projected onto the third contravariant direction.</p><p>The <span>$(\nabla_v \times \boldsymbol{u}_h + \nabla_h \times \boldsymbol{u}_v^j) \times \boldsymbol{u}^h$</span> term is discretized as</p><p class="math-container">\[(C^f_v[\boldsymbol{u}_h] + C_h[\boldsymbol{u}_v^j]) \times I^f(\boldsymbol{u}^h) ,\]</p><p>and the <span>$-\frac{1}{\rho^j} \nabla_v (p - p_{\text{ref}}) - \frac{\rho^j - \rho_{\text{ref}}}{\rho^j} \nabla_v \Phi - \nabla_v K^j$</span> term as</p><p class="math-container">\[-\frac{1}{I^f(\rho^j)} G^f_v[p - p_{\text{ref}}] - \frac{I^f(\rho^j - \rho_{\text{ref}})}{I^f(\rho^j)} G^f_v[\Phi] - G^f_v[K^j] ,\]</p><p>The hyperviscosity term is</p><p class="math-container">\[- \nu_u \hat{\mathcal{D}}_h (\mathcal{G}_h (\psi) )\]</p><p>where</p><p class="math-container">\[\psi = \mathcal{P} \left[ \hat{\mathcal{D}}_h \left( \mathcal{G}_h (w^j)\right) \right]\]</p><h3 id="Total-energy"><a class="docs-heading-anchor" href="#Total-energy">Total energy</a><a id="Total-energy-1"></a><a class="docs-heading-anchor-permalink" href="#Total-energy" title="Permalink"></a></h3><p class="math-container">\[\frac{\partial}{\partial t} \hat{\rho}^j e^j = - \nabla \cdot((\hat{\rho}^j e^j + \frac{\hat{\rho}^j}{\rho^j}p) \boldsymbol{u}^j) - \frac{p}{\rho} \frac{\partial}{\partial t} \hat{\rho}^j + RHS\]</p><p>which is stabilized with the addition of a 4th-order hyperdiffusion term on total enthalpy:</p><p class="math-container">\[- \nu_h \nabla \cdot \left( \hat{\rho}^j \nabla^3 \left(\frac{\rho^j e^j + p}{\rho^j} \right)\right)\]</p><p>is discretized using</p><p class="math-container">\[\frac{\partial}{\partial t} \hat{\rho}^j e^j \approx
- D_h[ (\hat{\rho^j} e^j + \frac{\hat{\rho^j}}{\rho^j}p) (\boldsymbol{u}_h + I^c(\boldsymbol{u}_v^j))]
- D^c_v \left[ WI^f(J,\hat{\rho}^j) \,  \tilde{\boldsymbol{u}}^j \, I^f \left(\frac{\hat{\rho^j} e^j + \frac{\hat{\rho^j}}{\rho^j}p}{\hat{\rho}^j} \right)
  \right] - \frac{p}{\rho} \frac{\partial}{\partial t} \hat{\rho}^j - \nu_h \hat{\mathcal{D}}_h( \rho \mathcal{G}_h(\psi^j) ) + RHS .\]</p><p>where</p><p class="math-container">\[\psi^j = \mathcal{P} \left[ \hat{\mathcal{D}}_h \left( \mathcal{G}_h \left(\frac{\rho^j e^j + p}{\rho^j} \right)\right) \right]\]</p><div class="admonition is-category-todo"><header class="admonition-header">Todo</header><div class="admonition-body"><p>Need to change this to first order upwinding.</p></div></div><h3 id="Moisture-tracers"><a class="docs-heading-anchor" href="#Moisture-tracers">Moisture tracers</a><a id="Moisture-tracers-1"></a><a class="docs-heading-anchor-permalink" href="#Moisture-tracers" title="Permalink"></a></h3><p>For a sub-domain moisture scalar <span>$q^j$</span>, the density-weighted scalar <span>$\hat{\rho}^j q^j$</span> obeys the conservation law</p><p class="math-container">\[\frac{\partial}{\partial t} \hat{\rho}^j q^j = - \nabla \cdot(\hat{\rho}^j q^j (\boldsymbol{u}^j - w_q^j \hat{\boldsymbol{k}})) + RHS .\]</p><p>where <span>$\hat{\boldsymbol{k}}$</span> is the vertical unit vector and <span>$w_q^j$</span> is the terminal velocity.</p><p>This is stabilized with the addition of a 4th-order hyperdiffusion term</p><p class="math-container">\[- \nu_q \nabla \cdot(\hat{\rho}^j \nabla^3(q^j))\]</p><p>This is discretized using the following</p><p class="math-container">\[\frac{\partial}{\partial t} \hat{\rho}^j q^j \approx
- D_h[ \hat{\rho}^j q^j (\boldsymbol{u}_h + I^c(\boldsymbol{u}_v^j))]
- D^c_v \left[ WI^f(J,\hat{\rho}^j) \, U^f\left( \tilde{\boldsymbol{u}}^j,  \frac{\hat{\rho}^j q^j}{\hat{\rho}^j} \right) \right]
- \nu_\chi \hat{\mathcal{D}}_h ( \hat{\rho^j} \, \mathcal{G}_h (\psi^j) ) + sedimentation + RHS.\]</p><p>where</p><p class="math-container">\[\psi^j = \mathcal{P} \left[ \hat{\mathcal{D}}_h \left( \mathcal{G}_h \left( \frac{\hat{\rho}^j q^j}{\hat{\rho}^j} \right)\right) \right]\]</p><p>Currently we use the central reconstruction</p><p class="math-container">\[- D^c_v \left[ WI^f(J,\hat{\rho}^j) \, \tilde{\boldsymbol{u}}^j \, I^f\left( \frac{\hat{\rho}^j q^j}{\hat{\rho}^j} \right) \right]\]</p><div class="admonition is-category-todo"><header class="admonition-header">Todo</header><div class="admonition-body"><p>Need to change this to first order upwinding.</p></div></div><div class="admonition is-category-todo"><header class="admonition-header">Todo</header><div class="admonition-body"><p>Write down the discretization for sedimentation. Assume the sedimentation velocity is zero for now.</p></div></div><h3 id="Other-tracers"><a class="docs-heading-anchor" href="#Other-tracers">Other tracers</a><a id="Other-tracers-1"></a><a class="docs-heading-anchor-permalink" href="#Other-tracers" title="Permalink"></a></h3><p>For a sub-domain scalar <span>$\chi^j$</span>, the density-weighted scalar <span>$\hat{\rho}^j \chi^j$</span> follows the continuity equation</p><p class="math-container">\[\frac{\partial}{\partial t} \hat{\rho}^j \chi^j = - \nabla \cdot(\hat{\rho}^j \chi^j \boldsymbol{u}^j) + RHS .\]</p><p>This is stabilized with the addition of a 4th-order hyperdiffusion term</p><p class="math-container">\[- \nu_\chi \nabla \cdot(\hat{\rho}^j \nabla^3(\chi^j))\]</p><p>This is discretized using the following</p><p class="math-container">\[\frac{\partial}{\partial t} \hat{\rho}^j \chi^j \approx
- D_h[ \hat{\rho^j} \chi^j (\boldsymbol{u}_h + I^c(\boldsymbol{u}_v^j))]
- D^c_v \left[ WI^f(J,\hat{\rho^j}) \, U^f\left( \tilde{\boldsymbol{u}}^j,  \frac{\hat{\rho}^j \chi^j}{\hat{\rho^j}} \right) \right]
- \nu_\chi \hat{\mathcal{D}}_h ( \hat{\rho^j} \, \mathcal{G}_h (\psi^j) ) + RHS.\]</p><p>where</p><p class="math-container">\[\psi^j = \mathcal{P} \left[ \hat{\mathcal{D}}_h \left( \mathcal{G}_h \left( \frac{\hat{\rho}^j \chi^j}{\hat{\rho}^j} \right)\right) \right]\]</p><p>Currently we use the central reconstruction</p><p class="math-container">\[- D^c_v \left[ WI^f(J,\hat{\rho}^j) \, \tilde{\boldsymbol{u}}^j \, I^f\left( \frac{\hat{\rho}^j \chi^j}{\hat{\rho}^j} \right) \right]\]</p><div class="admonition is-category-todo"><header class="admonition-header">Todo</header><div class="admonition-body"><p>Need to change this to first order upwinding.</p></div></div></article><nav class="docs-footer"><a class="docs-footer-prevpage" href="../equations/">« Equations</a><a class="docs-footer-nextpage" href="../diagnostics/">Diagnostics »</a><div class="flexbox-break"></div><p class="footer-message">Powered by <a href="https://github.com/JuliaDocs/Documenter.jl">Documenter.jl</a> and the <a href="https://julialang.org/">Julia Programming Language</a>.</p></nav></div><div class="modal" id="documenter-settings"><div class="modal-background"></div><div class="modal-card"><header class="modal-card-head"><p class="modal-card-title">Settings</p><button class="delete"></button></header><section class="modal-card-body"><p><label class="label">Theme</label><div class="select"><select id="documenter-themepicker"><option value="documenter-light">documenter-light</option><option value="documenter-dark">documenter-dark</option><option value="auto">Automatic (OS)</option></select></div></p><hr/><p>This document was generated with <a href="https://github.com/JuliaDocs/Documenter.jl">Documenter.jl</a> version 1.1.2 on <span class="colophon-date" title="Tuesday 14 November 2023 21:18">Tuesday 14 November 2023</span>. Using Julia version 1.9.4.</p></section><footer class="modal-card-foot"></footer></div></div></div></body></html>
