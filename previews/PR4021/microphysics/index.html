<!DOCTYPE html>
<html lang="en"><head><meta charset="UTF-8"/><meta name="viewport" content="width=device-width, initial-scale=1.0"/><title>Microphysics · ClimaAtmos.jl</title><meta name="title" content="Microphysics · ClimaAtmos.jl"/><meta property="og:title" content="Microphysics · ClimaAtmos.jl"/><meta property="twitter:title" content="Microphysics · ClimaAtmos.jl"/><meta name="description" content="Documentation for ClimaAtmos.jl."/><meta property="og:description" content="Documentation for ClimaAtmos.jl."/><meta property="twitter:description" content="Documentation for ClimaAtmos.jl."/><script data-outdated-warner src="../assets/warner.js"></script><link href="https://cdnjs.cloudflare.com/ajax/libs/lato-font/3.0.0/css/lato-font.min.css" rel="stylesheet" type="text/css"/><link href="https://cdnjs.cloudflare.com/ajax/libs/juliamono/0.050/juliamono.min.css" rel="stylesheet" type="text/css"/><link href="https://cdnjs.cloudflare.com/ajax/libs/font-awesome/6.4.2/css/fontawesome.min.css" rel="stylesheet" type="text/css"/><link href="https://cdnjs.cloudflare.com/ajax/libs/font-awesome/6.4.2/css/solid.min.css" rel="stylesheet" type="text/css"/><link href="https://cdnjs.cloudflare.com/ajax/libs/font-awesome/6.4.2/css/brands.min.css" rel="stylesheet" type="text/css"/><link href="https://cdnjs.cloudflare.com/ajax/libs/KaTeX/0.16.8/katex.min.css" rel="stylesheet" type="text/css"/><script>documenterBaseURL=".."</script><script src="https://cdnjs.cloudflare.com/ajax/libs/require.js/2.3.6/require.min.js" data-main="../assets/documenter.js"></script><script src="../search_index.js"></script><script src="../siteinfo.js"></script><script src="../../versions.js"></script><link class="docs-theme-link" rel="stylesheet" type="text/css" href="../assets/themes/catppuccin-mocha.css" data-theme-name="catppuccin-mocha"/><link class="docs-theme-link" rel="stylesheet" type="text/css" href="../assets/themes/catppuccin-macchiato.css" data-theme-name="catppuccin-macchiato"/><link class="docs-theme-link" rel="stylesheet" type="text/css" href="../assets/themes/catppuccin-frappe.css" data-theme-name="catppuccin-frappe"/><link class="docs-theme-link" rel="stylesheet" type="text/css" href="../assets/themes/catppuccin-latte.css" data-theme-name="catppuccin-latte"/><link class="docs-theme-link" rel="stylesheet" type="text/css" href="../assets/themes/documenter-dark.css" data-theme-name="documenter-dark" data-theme-primary-dark/><link class="docs-theme-link" rel="stylesheet" type="text/css" href="../assets/themes/documenter-light.css" data-theme-name="documenter-light" data-theme-primary/><script src="../assets/themeswap.js"></script></head><body><div id="documenter"><nav class="docs-sidebar"><a class="docs-logo" href="../"><img src="../assets/logo.svg" alt="ClimaAtmos.jl logo"/></a><div class="docs-package-name"><span class="docs-autofit"><a href="../">ClimaAtmos.jl</a></span></div><button class="docs-search-query input is-rounded is-small is-clickable my-2 mx-auto py-1 px-2" id="documenter-search-query">Search docs (Ctrl + /)</button><ul class="docs-menu"><li><a class="tocitem" href="../">Home</a></li><li><a class="tocitem" href="../installation_instructions/">Installation instructions</a></li><li><a class="tocitem" href="../contributor_guide/">Contributor Guide</a></li><li><a class="tocitem" href="../equations/">Equations</a></li><li class="is-active"><a class="tocitem" href>Microphysics</a><ul class="internal"><li><a class="tocitem" href="#Source-terms"><span>Source terms</span></a></li><li><a class="tocitem" href="#Sedimentation"><span>Sedimentation</span></a></li><li><a class="tocitem" href="#Stability-and-positivity"><span>Stability and positivity</span></a></li><li><a class="tocitem" href="#Aerosol-Activation-for-2-Moment-Microphysics"><span>Aerosol Activation for 2-Moment Microphysics</span></a></li></ul></li><li><a class="tocitem" href="../edmf_equations/">EDMF Equations</a></li><li><a class="tocitem" href="../diagnostics/">Diagnostics</a></li><li><a class="tocitem" href="../available_diagnostics/">Available Diagnostics</a></li><li><a class="tocitem" href="../diagnostic_edmf_equations/">Diagnostic EDMF Equations</a></li><li><a class="tocitem" href="../gravity_wave/">Gravity Wave Drag Parameterizations</a></li><li><a class="tocitem" href="../surface_albedo/">Ocean Surface Albedo Parameterization</a></li><li><a class="tocitem" href="../topography/">Topography Representation</a></li><li><a class="tocitem" href="../tracers/">Tracers</a></li><li><a class="tocitem" href="../implicit_solver/">Implicit Solver</a></li><li><a class="tocitem" href="../radiative_equilibrium/">Radiative Equilibrium</a></li><li><a class="tocitem" href="../single_column_prospect/">Single Column Model</a></li><li><a class="tocitem" href="../restarts/">Restarts and checkpoints</a></li><li><a class="tocitem" href="../repl_scripts/">REPL scripts</a></li><li><a class="tocitem" href="../config/">Configuration</a></li><li><a class="tocitem" href="../parameters/">Parameters</a></li><li><a class="tocitem" href="../longruns/">Longruns</a></li><li><a class="tocitem" href="../itime/">The time type</a></li><li><a class="tocitem" href="../api/">API</a></li><li><a class="tocitem" href="../references/">References</a></li></ul><div class="docs-version-selector field has-addons"><div class="control"><span class="docs-label button is-static is-size-7">Version</span></div><div class="docs-selector control is-expanded"><div class="select is-fullwidth is-size-7"><select id="documenter-version-selector"></select></div></div></div></nav><div class="docs-main"><header class="docs-navbar"><a class="docs-sidebar-button docs-navbar-link fa-solid fa-bars is-hidden-desktop" id="documenter-sidebar-button" href="#"></a><nav class="breadcrumb"><ul class="is-hidden-mobile"><li class="is-active"><a href>Microphysics</a></li></ul><ul class="is-hidden-tablet"><li class="is-active"><a href>Microphysics</a></li></ul></nav><div class="docs-right"><a class="docs-navbar-link" href="https://github.com/CliMA/ClimaAtmos.jl" title="View the repository on GitHub"><span class="docs-icon fa-brands"></span><span class="docs-label is-hidden-touch">GitHub</span></a><a class="docs-navbar-link" href="https://github.com/CliMA/ClimaAtmos.jl/blob/main/docs/src/microphysics.md" title="Edit source on GitHub"><span class="docs-icon fa-solid"></span></a><a class="docs-settings-button docs-navbar-link fa-solid fa-gear" id="documenter-settings-button" href="#" title="Settings"></a><a class="docs-article-toggle-button fa-solid fa-chevron-up" id="documenter-article-toggle-button" href="javascript:;" title="Collapse all docstrings"></a></div></header><article class="content" id="documenter-page"><h1 id="Microphysics"><a class="docs-heading-anchor" href="#Microphysics">Microphysics</a><a id="Microphysics-1"></a><a class="docs-heading-anchor-permalink" href="#Microphysics" title="Permalink"></a></h1><h2 id="Source-terms"><a class="docs-heading-anchor" href="#Source-terms">Source terms</a><a id="Source-terms-1"></a><a class="docs-heading-anchor-permalink" href="#Source-terms" title="Permalink"></a></h2><p>Sources from cloud microphysics <span>$\mathcal{S}$</span> represent the transfer of mass   between different water categories such as cloud water, cloud ice or precipitation,   as well as the latent heat release due to phase changes. The model supports three different cloud microphysics and precipitation representations:</p><ul><li>equilibrium cloud formation coupled with a 0-moment microphysics scheme,</li><li>nonequilibrium cloud formation coupled with a 1-moment microphysics scheme representing both liquid and ice phase precipitation,</li><li>nonequilibrium cloud formation coupled with a 2-moment microphysics scheme representing liquid phase precipitation.</li></ul><p>The equilibrium 0-moment option does not introduce any new variables to the state vector. The cloud condensate and phase partitioning are diagnosed using saturation adjustment   and the 0-moment microphysics provides a sink on total water due to precipitation. Precipitation is immediately removed from the computational domain. The nonequilibrium 1-moment option expands the state vector by four microphysics tracers:   cloud liquid water, cloud ice, rain and snow <span>$(q_{liq}, q_{ice}, q_{rai}, q_{sno})$</span>. The nonequilibrium 2-moment option expands the state vector by four microphysics tracers:   cloud liquid water and droplet number concentration, rain water and drop number concentration:    <span>$(q_{liq}, N_{liq}, q_{rai}, N_{rai})$</span>.</p><p>All microphysics mass tracers are part of the working fluid   and are defined as a ratio of the tracer mass over the mass of the working fluid. The different cloud and precipitation source terms are provided by   <a href="https://github.com/CliMA/CloudMicrophysics.jl">CloudMicrophysics.jl</a> library   and are defined as the change of mass normalized by the mass of the working fluid. See the <a href="https://clima.github.io/CloudMicrophysics.jl/dev/">CloudMicrophysics.jl docs</a>   for more details.</p><p>Considering the transition from   <span>$x \rightarrow y$</span> where <span>$x$</span> and <span>$y$</span> can be any of the microphysics tracers</p><p class="math-container">\[\mathcal{S}_{x \rightarrow y} := \frac{\frac{dm_x}{dt}}{m_{dry} + m_{vap} + m_{liq} + m_{ice} + m_{rai} + m_{sno}}\]</p><p>If <span>$\mathcal{S}_{x \rightarrow y}$</span> is a sink of <span>$q_{tot}$</span> from the 0-moment scheme   it has a corresponding sink on density and energy:</p><p class="math-container">\[\frac{d}{dt} \rho =
\frac{d}{dt} \rho q_{tot} =
\rho \mathcal{S}_{x \rightarrow y}\]</p><p class="math-container">\[\frac{d}{dt} \rho e = \rho \mathcal{S}_{x \rightarrow y} (I_{y} + \Phi)\]</p><p>where <span>$I_{y}$</span> is the internal energy of the <span>$y$</span> phase.</p><p>In nonequilibrium cloud formation and the 1-moment and 2-moment schemes,   since all microphysics tracers are part of the working fluid,   microphysics sources do not introduce corresponding sources/sinks of   total water, density or total energy.</p><div class="admonition is-todo" id="Todo-a8169bbdc89798d4"><header class="admonition-header">Todo<a class="admonition-anchor" href="#Todo-a8169bbdc89798d4" title="Permalink"></a></header><div class="admonition-body"><p>In the above derivations we are assuming that the volume of the working fluid is constant (not the pressure).</p></div></div><h2 id="Sedimentation"><a class="docs-heading-anchor" href="#Sedimentation">Sedimentation</a><a id="Sedimentation-1"></a><a class="docs-heading-anchor-permalink" href="#Sedimentation" title="Permalink"></a></h2><p>All microphysics tracers sediment with a bulk (group) sedimentation velocity   parameterized via <a href="https://github.com/CliMA/CloudMicrophysics.jl">CloudMicrophysics.jl</a>. Sedimentation is done implicitly through a first-order upwinding scheme. Because all tracers are part of the working fluid, their sedimentation   results in sedimentation terms for density and total energy.</p><div class="admonition is-todo" id="Todo-c00b0eed1e2b4bd4"><header class="admonition-header">Todo<a class="admonition-anchor" href="#Todo-c00b0eed1e2b4bd4" title="Permalink"></a></header><div class="admonition-body"><p>We assume that all microphysics tracers are at ambient air temperature. It would be more correct to assume that the microphysics tracers are at wet bulb temperature.</p></div></div><h2 id="Stability-and-positivity"><a class="docs-heading-anchor" href="#Stability-and-positivity">Stability and positivity</a><a id="Stability-and-positivity-1"></a><a class="docs-heading-anchor-permalink" href="#Stability-and-positivity" title="Permalink"></a></h2><p>Microphysics tracers should remain positive throughout the simulation. The numerics of the model however, may result in errors that lead to the spurious formation   of small negative numbers. Most common causes of those errors are:</p><ul><li>spurious oscillations caused by the high order horizontal transport scheme,</li><li>time integration of microphysics sources at time-step that is longer than the stability limit,</li><li>use of hyperdiffusion.</li></ul><p>Our strategy is to minimize the untoward effects of those errors,   without aiming for strict positivity.</p><h3 id="Limiters"><a class="docs-heading-anchor" href="#Limiters">Limiters</a><a id="Limiters-1"></a><a class="docs-heading-anchor-permalink" href="#Limiters" title="Permalink"></a></h3><p>All microphysics source terms are individually limited by the available mass of the source tracer <span>$x$</span>. We typically set <span>$lim_x = \frac{q_x}{a \; dt}$</span> where <span>$a &gt; 1$</span>. The limiter is formulated based on the triangle inequality:</p><p class="math-container">\[limiter(\mathcal{S}_{x \rightarrow y}, lim_x, lim_y) = \mathcal{S}_{x \rightarrow y} + lim_x - \sqrt{\mathcal{S}_{x \rightarrow y}^2 + lim_x^2}\]</p><p>If the source is positive but larger than the available tracer <span>$lim_x$</span>,   the tendency is smoothly adjusted. If, due to numerics, the source tracer is negative, the resulting tendency switches signs and acts   as a restoring force towards a state where the tracer is positive. This means that instead of <span>$x \rightarrow y$</span> transfer, we now consider <span>$y \rightarrow x$</span>. In such cases we limit the tendency by the available mass of the new source tracer <span>$y$</span>. All the tendencies passed to the limiter should be positive. In case the numerics switches the sign of the source term itself,   we again treat it as an inverted process <span>$y \rightarrow x$</span>: <span>$limiter(\mathcal{S}_{x \rightarrow y}, lim_x, lim_y) = -limiter(-\mathcal{S}_{x \rightarrow y}, lim_y, lim_x)$</span>. Below figure illustrates the behavior of the limiter for positive and negative force   with the <span>$x$</span> tracer being capped at 5 and the <span>$y$</span> tracer being capped at 2.</p><p><img src="../assets/limiters_plot.png" alt/></p><h3 id="Hyperdiffusion"><a class="docs-heading-anchor" href="#Hyperdiffusion">Hyperdiffusion</a><a id="Hyperdiffusion-1"></a><a class="docs-heading-anchor-permalink" href="#Hyperdiffusion" title="Permalink"></a></h3><p>Hyperdiffusion (<span>$\nabla^4$</span> operator) is a tendency applied   in order to remove noise buildup at the small scales and improve the model stability. It&#39;s more selective than standard diffusion operator, and applies the damping only   at the smallest scales of the simulation without degrading the sharp features   of the modeled tracers.</p><p>Hyperdiffusion is a higher order derivative operator, and as a result does not guarantee positivity. The user has a choice to opt-in certain microphysics tracers to use hyperdiffusion. By default hyperdiffusion is applied to total water and cloud tracers,   but not precipitating tracers. The magnitude of hyperdiffusion acting on precipitation tracers can be changed by   adjusting the free parameter <code>tracer_hyperdiffusion_factor</code>.</p><h3 id="Diffusion"><a class="docs-heading-anchor" href="#Diffusion">Diffusion</a><a id="Diffusion-1"></a><a class="docs-heading-anchor-permalink" href="#Diffusion" title="Permalink"></a></h3><p>ClimaAtmos provides different horizontal and vertical diffusion schemes that can be used   to improve model stability and reduce the negative numbers and spurious oscillations.</p><p>Horizontal diffusion tendency is based on either the Smagorinsky-Lilly model   [<a href="../references/#Sridhar2022">1</a>] or the Anisotropic Minimum-Dissipation model (AMD) [<a href="../references/#Akbar2016">2</a>]   and is applied explicitly.</p><p>Vertical diffusion tendency can be based on either of the above models,   or computed as a decaying with height function that is capped at some value above the tropopause. Vertical diffusion can be applied implicitly. When using the decay with height options (<code>VerticalDiffusion</code> or <code>DecayWithHeight</code>),   similar to hyperdiffusion,  diffusion is applied to total water and cloud tracers. The magnitude of diffusion acting on precipitation tracers can be scaled using the   <code>tracer_vertical_diffusion_factor</code>. There is no such scaling applied when using the Smagorinsky-Lilly or AMD models.</p><h2 id="Aerosol-Activation-for-2-Moment-Microphysics"><a class="docs-heading-anchor" href="#Aerosol-Activation-for-2-Moment-Microphysics">Aerosol Activation for 2-Moment Microphysics</a><a id="Aerosol-Activation-for-2-Moment-Microphysics-1"></a><a class="docs-heading-anchor-permalink" href="#Aerosol-Activation-for-2-Moment-Microphysics" title="Permalink"></a></h2><p>Aerosol activation uses functions from the <a href="https://github.com/CliMA/CloudMicrophysics.jl">CloudMicrophysics.jl</a> library, based on the Abdul-Razzak and Ghan (ARG) parameterization. ARG predicts the number of activated cloud droplets assuming a parcel of clear air rising adiabatically. This formulation is traditionally applied only at cloud base, where the maximum supersaturation typically occurs.</p><p>To enable ARG to be used locally (i.e., without explicitly identifying cloud base), CloudMicrophysics.jl implements a modified equation for the maximum supersaturation that accounts for the presence of pre-existing liquid and ice particles. This allows activation to be applied inside clouds. To ensure that activation occurs only where physically appropriate, we apply additional clipping logic:</p><ul><li>If the predicted maximum supersaturation is less than the local supersaturation (i.e., supersaturation is decreasing), aerosol activation is not applied.</li><li>If the predicted number of activated droplets is less than the existing local cloud droplet number concentration, activation is also suppressed.</li></ul><p>This ensures that droplet activation occurs only in physically meaningful regions—typically near cloud base—even though the activation routine can be applied throughout the domain.</p></article><nav class="docs-footer"><a class="docs-footer-prevpage" href="../equations/">« Equations</a><a class="docs-footer-nextpage" href="../edmf_equations/">EDMF Equations »</a><div class="flexbox-break"></div><p class="footer-message">Powered by <a href="https://github.com/JuliaDocs/Documenter.jl">Documenter.jl</a> and the <a href="https://julialang.org/">Julia Programming Language</a>.</p></nav></div><div class="modal" id="documenter-settings"><div class="modal-background"></div><div class="modal-card"><header class="modal-card-head"><p class="modal-card-title">Settings</p><button class="delete"></button></header><section class="modal-card-body"><p><label class="label">Theme</label><div class="select"><select id="documenter-themepicker"><option value="auto">Automatic (OS)</option><option value="documenter-light">documenter-light</option><option value="documenter-dark">documenter-dark</option><option value="catppuccin-latte">catppuccin-latte</option><option value="catppuccin-frappe">catppuccin-frappe</option><option value="catppuccin-macchiato">catppuccin-macchiato</option><option value="catppuccin-mocha">catppuccin-mocha</option></select></div></p><hr/><p>This document was generated with <a href="https://github.com/JuliaDocs/Documenter.jl">Documenter.jl</a> version 1.15.0 on <span class="colophon-date" title="Friday 31 October 2025 23:59">Friday 31 October 2025</span>. Using Julia version 1.11.7.</p></section><footer class="modal-card-foot"></footer></div></div></div></body></html>
